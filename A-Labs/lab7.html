<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-A-Labs/lab7">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/OSL740/img/pwa/icon-512x512.png">
<link rel="manifest" href="/OSL740/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/OSL740/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/OSL740/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/OSL740/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Lab 7 | OSL740 - Administration of Open Source Systems</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 7 | OSL740 - Administration of Open Source Systems"><meta data-rh="true" name="description" content="SSH"><meta data-rh="true" property="og:description" content="SSH"><link data-rh="true" rel="icon" href="/OSL740/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7" hreflang="x-default"><link rel="stylesheet" href="/OSL740/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/OSL740/assets/js/runtime~main.6b6f3019.js" as="script">
<link rel="preload" href="/OSL740/assets/js/main.8404b104.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/OSL740/"><div class="navbar__logo"><img src="/OSL740/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/OSL740/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OSL740 - Administration of Open Source Systems</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OSL740/">Welcome to OSL740</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OSL740/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/OSL740/A-Labs/lab1-vbox">Labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab1-vbox">Lab 1 - VirtualBox Version</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab1-vmware">Lab 1 - VMware Version</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab1-vmware-graphic-install">Lab 1 - VMware Version (Graphical Install)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab2">Lab 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab3">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab4">Lab 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab5">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab6">Lab 6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/OSL740/A-Labs/lab7">Lab 7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab8">Lab 8</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OSL740/B-Assignments/assignment1">Assignments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OSL740/C-ExtraResources/tips">Extra Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/OSL740/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Labs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 7</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 7: Setup and Configure SSH</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-preparation">Lab Preparation<a class="hash-link" href="#lab-preparation" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="purpose-and-objectives-of-lab-7">Purpose and Objectives of Lab 7<a class="hash-link" href="#purpose-and-objectives-of-lab-7" title="Direct link to heading">​</a></h3><p>Setting up a computer network is very important, but often the Linux system administrator must also perform networking maintenance which includes <strong>trouble-shooting, repairing network connection issues</strong> and <strong>maintaining network security</strong>. System administrators need to <strong>protect or &quot;harden&quot; their computer networks from &quot;penetration&quot; from unauthorized computer users</strong>. Hardening a computer system can range from running an <strong>IDS</strong> (Intrusion Detection System) to monitoring and flagging suspicious activity to implementing security policies which could range from running firewalls to setting locked screen savers on workstations.</p><p>In this lab, you will learn how to configure the SSH service in Debian to allow users to securely access and share data between authorized personnel. In addition. Topics such as, using <strong>Public Key Authentication</strong>, setting up an <strong>SSH tunnel</strong> in order to securely run graphical applications safely among computers in the network, and <strong>disabling root login</strong> into a Linux machine. You will also learn how to configure firewall rules to control the flow of packets in and out of your computer.</p><p><img loading="lazy" alt="Firewall" src="/OSL740/assets/images/Firewall-47ee633533b09162d89becea33f4d978.png" width="232" height="237" class="img_ev3q"></p><p>Preventing unauthorized access is one of the many day-to-day operations for a Linux system administrator and/or security specialist</p><p><strong>Main Objectives</strong></p><ol><li><p>To use the <strong>ssh</strong> and <strong>scp</strong> commands to access and copy data between Linux servers in a secure manner</p></li><li><p>Configure, and start the Secure Shell Service (<strong>ssh</strong>)</p><ul><li>To refuse root login from remote Linux servers or limit users that are permitted to ssh into Linux servers</li></ul></li><li><p>Generate Public/Private keypairs to enable secure authentication to Linux servers</p></li><li><p>Use ssh to <strong>tunnel Xwindow applications</strong></p></li><li><p>Configure the firewall to set a default policy and add exceptions to the policy chains</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minimum-required-materials">Minimum Required Materials<a class="hash-link" href="#minimum-required-materials" title="Direct link to heading">​</a></h3><ul><li><strong>Solid State Drive</strong></li><li><strong>USB key</strong> (for backups)</li><li><strong>Lab7 Log Book</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-command-reference">Linux Command Reference<a class="hash-link" href="#linux-command-reference" title="Direct link to heading">​</a></h3><p><strong>Networking Utilities</strong></p><table><thead><tr><th><a href="http://man7.org/linux/man-pages/man1/ssh.1.html" target="_blank" rel="noopener noreferrer">ssh</a></th><th><a href="http://man7.org/linux/man-pages/man1/ssh-keygen.1.html" target="_blank" rel="noopener noreferrer">ssh-keygen</a></th><th><a href="http://linux.die.net/man/1/ssh-copy-id" target="_blank" rel="noopener noreferrer">ssh-copy-id</a></th><th><a href="http://man7.org/linux/man-pages/man1/scp.1.html" target="_blank" rel="noopener noreferrer">scp</a></th><th><a href="http://man7.org/linux/man-pages/man1/sftp.1.html" target="_blank" rel="noopener noreferrer">sftp</a></th><th><a href="http://man7.org/linux/man-pages/man8/ss.8.html" target="_blank" rel="noopener noreferrer">ss</a></th><th><a href="http://man7.org/linux/man-pages/man8/ip.8.html" target="_blank" rel="noopener noreferrer">ip</a></th><th><a href="http://man7.org/linux/man-pages/man8/ping.8.html" target="_blank" rel="noopener noreferrer">ping</a></th><th><a href="http://man7.org/linux/man-pages/man8/arp.8.html" target="_blank" rel="noopener noreferrer">arp</a></th><th><a href="https://wiki.debian.org/iptables" target="_blank" rel="noopener noreferrer">iptables</a></th></tr></thead></table><p><strong>Additional Utilities</strong></p><ul><li><a href="http://man7.org/linux/man-pages/man7/hostname.7.html" target="_blank" rel="noopener noreferrer">hostname</a></li><li><a href="https://man7.org/linux/man-pages/man1/hostnamectl.1.html" target="_blank" rel="noopener noreferrer">hostnamectl</a></li></ul><p><strong>Managing Services</strong></p><ul><li><a href="http://www.dsm.fordham.edu/cgi-bin/man-cgi.pl?topic=systemctl" target="_blank" rel="noopener noreferrer">systemctl</a></li></ul><p><strong>Configuration Files</strong></p><ul><li><a href="https://linux.die.net/man/5/ssh_config" target="_blank" rel="noopener noreferrer">ssh_config</a></li><li><a href="https://linux.die.net/man/5/sshd_config" target="_blank" rel="noopener noreferrer">sshd_config</a></li></ul><p><strong>SSH Reference</strong></p><ul><li><a href="https://wiki.debian.org/SSH" target="_blank" rel="noopener noreferrer">Debian SSH Guide</a></li><li><a href="https://linuxconfig.org/how-to-secure-ssh" target="_blank" rel="noopener noreferrer">A good HOW-TO to make ssh more secure</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-1-installing-and-maintaining-an-ssh-server">Investigation 1: Installing And Maintaining An SSH Server<a class="hash-link" href="#investigation-1-installing-and-maintaining-an-ssh-server" title="Direct link to heading">​</a></h2><p>So far, you have learned to use the <strong>ssh</strong> utility to establish a secure connection to a remote host in order to perform Linux administration tasks. You have issued the ssh command, which is actually the <strong>client</strong> application for ssh. In order to connect to a remote server (like your VMs, Matrix, etc) it needs to run the <strong>SSH service</strong> (aka <strong>sshd</strong>).</p><p>In this section, you will learn how to configure an SSH server and restart the ssh service for an existing VM. You will also learn how to configure, restart, and use SSH in order to create secure connections between your Linux machines (host as well as VMs).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-confirming-sshd-service-is-running-on-vms">Part 1: Confirming sshd service is Running on VMs.<a class="hash-link" href="#part-1-confirming-sshd-service-is-running-on-vms" title="Direct link to heading">​</a></h3><p><strong>Perform the following steps:</strong></p><p>Some tasks in this part of the investigation <strong>require you to be connected to Seneca&#x27;s VPN</strong>.</p><ul><li><p>If you are running your installation through VMWare, then you can use the <a href="https://students.senecacollege.ca/spaces/186/it-services/wiki/view/1025/student-vpn" target="_blank" rel="noopener noreferrer">instructions provided by ITS</a> to connect to it from your Windows machine (your debhost and its nested VMs will use the VPN through the windows machine without further configuration).</p></li><li><p>If you installed your debhost <strong>directly onto a machine without using VMWare</strong> as an intermediary (or the steps above do not work for you), use the following instructions:</p><ul><li>Install the package openconnect</li><li>Run the following command as root (or with sudo): <code>openconnect --protocol=gp studentvpn.senecacollege.ca -b</code></li><li>This should prompt you for your username and password (you could also put the user name in the command with -p)</li><li>You&#x27;ll know it is working if you check your ip address and see something in the 10.0.0.0/8 range.</li><li>To disconnect, as root (or with sudo): <code>killall openconnect</code></li></ul></li></ul><p>Once you have connected to the VPN with either method you may continue</p><ol><li>Launch your <strong>debhost machine</strong> and your <strong>deb1</strong> and <strong>deb3</strong> VMs.</li><li>Switch to your <strong>debhost</strong> VM.</li><li>Create a file in your current directory of your debhost machine with some text in it called: <strong>myfile.txt</strong></li><li>Issue the following command (using your Matrix login id):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Copy file to remote host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> myfile.txt yourmatrixid@matrix.senecacollege.ca:/home/yourmatrixid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(followed by your Matrix password)</li><li>What did this command do?</li></ul><ol start="5"><li>Issue the following single command (arguments are separated by a space - use your Matrix login id):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Connect to remote host to execute a single command to confirm copy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> yourmatrixid@matrix.senecacollege.ca </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> /home/yourmatrixid/myfile.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(followed by your Matrix password)</li><li>What did this command do?</li><li>Issue the following Linux command:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Connect to remote host and display the contents of the file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> yourmatrixid@matrix.senecacollege.ca </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /home/yourmatrixid/myfile.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>How do these commands differ from using issuing the ssh command without the ls or cat command? How is this useful?</li><li>The client ssh application contains the utilities: <strong>ssh</strong>, <strong>scp</strong> and <strong>sftp</strong> (introduced in ULI101) to connect to remote Linux hosts in order to issue commands or transfer files between the Linux hosts. You can install the SSH service on your Linux server, although this has already been performed upon installation. We will now confirm that the ssh service is running on all of your VMs.</li></ul><ol start="6"><li>OpenSSH should have been installed by default. Let&#x27;s confirm this by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># List installed packages filtering for ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dpkg -l </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>You should see a number of packages installed including <strong>openssh-client</strong> and <strong>openssh-server</strong></li><li>The <strong>openssh-server</strong> package installs a service called <strong>ssh</strong>.</li><li>Confirm that this service is running by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Check status of a service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status </span><span class="token function" style="color:#d73a49">ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>Note:</strong> Debian&#x27;s service is called <strong>ssh</strong> but the process is called <strong>sshd</strong>.</p><p>You can use either name to refer to the service</p></blockquote><ol start="10"><li>Now that you know the service is running, investigate what <strong>port number</strong> and <strong>protocol</strong> sshd uses by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># List active TCP and UDP ports with numeric output including &quot;process&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ss -p Requires sudo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ss -atunp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>What protocol and port is the sshd process using? What is the state of the port?</li></ul><ol start="11"><li>Reissue the <code>ss</code> command without the <strong>-n</strong> option. What is the difference?</li></ol><p><img loading="lazy" alt="debhostss2" src="/OSL740/assets/images/debhostss2-2ea404dbb1f700f00494b36391a8722d.png" width="1505" height="268" class="img_ev3q"></p><ol start="12"><li>You can refer to the <strong>/etc/services</strong> file in order to determine a port number for a service. Issue the following command to confirm that port 22 is associated with ssh:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Search for ssh port number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> /etc/services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="13"><li>Make sure all of your VM&#x27;s are started and confirm that the <strong>ssh</strong> service is running on <strong>all 3 of your VM&#x27;s</strong></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-ssh-server-security-configuration">Part 2: SSH Server Security Configuration<a class="hash-link" href="#part-2-ssh-server-security-configuration" title="Direct link to heading">​</a></h3><p>Any time that you configure your computer to allow logins from the network you are leaving yourself <strong>vulnerable to potential unauthorized access</strong> by penetration testers or even hackers. Running the ssh service is a fairly common practice but care must be taken to make things more difficult for those individuals that attempt to use <strong>brute force attacks</strong> to gain access to your system. Hackers use their knowledge of your system and can use <strong>password guessing programs</strong> help to gain access. They know which port is likely open to attack (TCP:22), and the name of the administrative account name (root).</p><p><strong>Read this <a href="https://linuxconfig.org/how-to-secure-ssh" target="_blank" rel="noopener noreferrer">Securing SSH</a> tutorial.</strong></p><p>The Linux system administrator can <strong>configure the SSH server</strong> in order to make the SSH server less vulnerable to attacks. Examples include not permitting root login, and changing the default port number for the ssh service.</p><p><strong>Perform the following steps using your debhost and deb1 VM&#x27;s:</strong></p><ol><li>Change to your <strong>deb1</strong> VM and open a terminal and start a sudo shell.</li><li>Read the man page for the <code>sshd_config</code> file. Search for the <code>PermitRootLogin</code> option and read about the possible settings.</li><li>Edit the file <strong>/etc/ssh/sshd_config</strong> and look for the option <code>PermitRootLogin</code>.</li><li>Un-comment the option and change the option value to <code>no</code>.</li></ol><p><img loading="lazy" alt="sshdconfig" src="data:image/png;base64,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" width="160" height="142" class="img_ev3q"></p><blockquote><p><strong>NOTE</strong>: Now any hacking attempt also has to guess an account name as well as the password. If you need root access on the host, you ssh to the host as a regular user and then use <strong>sudo</strong> to access root privileges, just like on the local system.</p></blockquote><ol start="5"><li>As well as disabling ssh access as root, it is possible to restrict access to just the specific users that require it.</li><li>Read the man page for the <code>sshd_config</code> file. Search for and read about the <code>AllowUsers</code> and <code>AllowGroups</code> options.</li><li>Edit the file <strong>/etc/ssh/sshd_config</strong> and add a new option of <code>AllowUsers yourAccountName</code> (where &quot;yourAccountName&quot; is your regular user account for your deb1 VM)</li></ol><p><img loading="lazy" alt="sshdconfig2" src="data:image/png;base64,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" width="224" height="153" class="img_ev3q"></p><ol start="8"><li>In order for these changes to take affect, you need to restart the ssh service:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Restart ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart </span><span class="token function" style="color:#d73a49">ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="9"><li>Try using ssh from your <strong>debhost</strong> VM to your <strong>deb1</strong> VM as <strong>root</strong>. Where you successful?</li><li>Try using ssh from your <strong>debhost</strong> VM to your <strong>deb1</strong> VM as your regular user account. Did it work?</li><li>Create another user on deb1 called <strong>other</strong>, include the options to create a home directory and set the shell to <strong>/bin/bash</strong></li><li>Set the password for the newly-created user called <strong>other</strong></li><li>Try using ssh from your <strong>debhost</strong> VM to your <strong>deb1</strong> VM as the account called <strong>other</strong>. Why didn&#x27;t it work?</li><li>On <strong>deb1</strong> add the user <strong>other</strong> to the supplemental group <strong>sudo</strong>.</li><li>Edit the file <strong>/etc/ssh/sshd_config</strong> and add a new option of <code>AllowGroups sudo</code></li><li>Comment out the <code>AllowUsers</code> option, save the file, and <strong>restart ssh</strong></li><li>Try using ssh from your <strong>debhost</strong> VM to your <strong>deb1</strong> VM as the user account called <strong>other</strong>. Did it work this time?</li></ol><p><strong>Monitoring access</strong></p><p>An important task of a System Administrator is to monitor for attempts at unauthorized remote access. All ssh connection attempts are recorded in the <strong>systemd</strong> log/journal. The <strong>journalctl</strong> command can be used to view the journal messages</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># View all journal entries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> journalctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># View the journal entries concerning the ssh unit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> journalctl -u </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># View the journal entries concerning the ssh unit for today</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> journalctl -u </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> --since today</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># View sudo related entries since yesterday.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> journalctl --since yesterday </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><strong>Note:</strong> systemd services and targets are 2 types of systemd &quot;units&quot;</p></blockquote><ol><li>Check the journal entries on <strong>deb1</strong>. Try to find the entries showing the other user and the root user being denied access.</li><li>Try to find examples of entries reporting the use of <strong>sudo</strong></li></ol><p><strong>Answer INVESTIGATION 1 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-2-additional-methods-to-secure-your-ssh-server">Investigation 2: Additional Methods To Secure Your SSH Server<a class="hash-link" href="#investigation-2-additional-methods-to-secure-your-ssh-server" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-generating-private-and-public-keys-public-key-infrastructure">Part 1: Generating Private and Public Keys (Public Key Infrastructure)<a class="hash-link" href="#part-1-generating-private-and-public-keys-public-key-infrastructure" title="Direct link to heading">​</a></h3><p>As a method of authentication, using account passwords as the sole authentication factor is deeply flawed. Users have terrible password habits like using the same password for multiple systems/websites, using uncomplicated passwords, writing passwords down, and not changing the password. Practises such as forced frequent password changes have not greatly improved the problem. Increasingly you are seeing multi-factor authentication systems being used to improve the reliability of authentication.</p><p>We can configure <strong>ssh public/private keys</strong> to be used as a method of authentication instead. This will allow users to generate a pair of matching public/private keys, adding the public key to their account on the remote host. The private key remains on the local host. When the user attempts to connect to the remote host, <strong>ssh</strong> will use the private key to digitally sign the request. On the remote host ssh uses the matching public key to verify the signature.</p><blockquote><p><img loading="lazy" alt="caution" src="data:image/png;base64,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" width="64" height="64" class="img_ev3q"></p><p>Public/Private key authentication is secure and convenient, and it does eliminate many of the problems created by user behavior with passwords.</p><p><strong>However,</strong> key files, especially <strong>Private</strong> keys must be properly taken care of. Imagine that the private key can be used to unlock a vault that contains millions of dollars.</p><ul><li>If you lose the key, you can&#x27;t open the vault.</li><li>If you leave the key in an insecure location, it can be copied or stolen. Somebody could steal your money.</li><li>If you make copies of the key you are increasing the chances of it being exposed.</li><li>If you suspect that your key has been compromised you should change the locks on the vault. (Generate new keys)</li></ul></blockquote><p>Therefore, understanding the generation and management of public/private keys is important to the security of our system.</p><p><strong>Storing Fingerprints</strong></p><p>When a user connects to a host using ssh, the host sends a &quot;fingerprint&quot; or digital signature to the client to establish its identity. The first time a connection is established the identity must be stored for comparison during subsequent connections. The fingerprints are stored separately for each user in a file called <code>~/.ssh/known_hosts</code> .</p><p><img loading="lazy" alt="sshfingerprint" src="/OSL740/assets/images/sshfingerprint-81531098c0c4404e31c5f3549a45f80e.png" width="671" height="114" class="img_ev3q"></p><p>From now on when you connect to that host the client will compare the received fingerprint against the list of known hosts before connecting. If the fingerprint does not match it could indicate somebody had setup a system to impersonate the computer you wish to connect.</p><p>If you ever receive a message like the one displayed below, it means the fingerprint you received from the server does not match the fingerprint you have stored for that remote host in the file <strong><code>~/.ssh/known_hosts</code></strong>.</p><p>You should investigate why it is happening as it could indicate a <strong>serious security issue</strong>, or it could just mean that something on <strong>the remote host has changed</strong> (i.e. the OS was reinstalled)</p><p><img loading="lazy" alt="Spoof" src="/OSL740/assets/images/Spoof-33a214307013854d9d325b6da862c8c2.png" width="510" height="268" class="img_ev3q"></p><p><strong>Perform the following steps:</strong></p><ol><li>Login to your <strong>deb3</strong> VM as your regular user account (login via the VM viewer, NOT using ssh)</li><li>Run the following command to check the state of any possible <em>ssh connections</em>. What is the state (i.e. LISTENING or ESTABLISHED)?</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Display the status of ssh ports</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ss -atnp </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>While in your <strong>deb3</strong> VM, issue the following command to connect to <strong>your same VM</strong> via ssh:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> username@deb3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Enter <strong>yes</strong> at the prompt, and enter your password. The output should appear similar as what is shown below:</li></ol><p><img loading="lazy" alt="sshfingerprint2" src="/OSL740/assets/images/sshfingerprint2-7cc3123abc96e8dfc628890bfdc2e47c.png" width="754" height="306" class="img_ev3q"></p><ol start="5"><li>Re-run the same <strong>ss</strong>. Is there any change to the connection status?</li></ol><p><img loading="lazy" alt="deb3sshports" src="/OSL740/assets/images/deb3sshports-2731d42b835f5895099585c53d51846e.png" width="1021" height="126" class="img_ev3q"></p><p><strong>Note:</strong> Because we have used ssh to connect <strong>from</strong> deb3 <strong>to</strong> deb3 we can see the ports from both the <strong>client</strong> and <strong>server</strong> point of view.</p><ol start="6"><li>Log-out of your ssh connection by typing <code>exit</code>.</li><li>Run that same <strong>ss</strong> command again. If you are fast enough you may see the port status is being closed.</li><li>Wait a few minutes and then check again. Record your observations.</li></ol><p><strong>KeyPair Authentication</strong></p><p>So far, you have learned to establish an ssh connection to another host using a password to authenticate your identity. But <strong>passwords are not the only or even the best way of authenticating your identity</strong>. We can also use <strong>Public/Private key encryption</strong>.</p><p><strong>Public Key authentication</strong> is a method of establishing identity using a <strong>pair of encryption keys that are designed to work together</strong>. One key is known as your <strong>private key</strong> (which as the name suggests should remain private and protected) and the other is known as the <strong>public key</strong> (which as the name suggests can be freely distributed) The keys are designed to work together to encrypt data asymmetrically, that is to say that when we <strong>encrypt data with one of the keys it can only be decrypted with the other key</strong> from the pair.</p><p>If a message is encrypted using the Private key on the local host, and the server on the remote host can decrypt the message successfully using the matching Public key, then the server knows the message could only have come from the local host. The message itself is not secure because potentially any body with a copy of the Public key could read it. But the fact that it could only have come from the host with the Private key proves the identity of the client.</p><ol><li>Switch to your <strong>deb2</strong> VM. Login as your regular user account</li><li>Confirm you are in your deb2 VM by entering the command: <code>hostname</code></li><li>Consider the following commands:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Generate a keypair</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Copy the public key to your account on the remote host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id username@hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Copy a specific key to your account on the remote host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id -i ~/.ssh/mykey.pub username@hostname</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>To generate a keypair (public/private keys), issue the following command: <code>ssh-keygen</code></li></ol><p>After generating the keys it prompts you for the location to save the keys. The default is <strong>~/.ssh</strong> Your private key will be saved as <strong>id_rsa</strong> and your public key will be saved as <strong>id_rsa.pub</strong> by default.</p><ol start="5"><li>Press ENTER to accept the default.</li><li>You will then be prompted for a <strong>pass-phrase</strong>. The pass-phrase must be entered in order to &quot;unlock&quot; your private key. Pass-phrases are more secure than passwords and should be lengthy, hard to guess and easy to remember. For example one pass-phrase that meets this criteria might be &quot;<em>seneca students like to dance at 4:00am</em>&quot;. Avoid famous phrases such as &quot;<em>to be or not to be</em>&quot; as they are easy to guess. It is possible to leave the pass-phrase blank but this is dangerous. It means that if a hacker was able to get into your account, they could then use your private key to access the other systems you use.</li><li>Enter a lengthy passphrase you will remember</li></ol><p>The output should appear similar to what is shown below:</p><p><img loading="lazy" alt="sshkeygen" src="/OSL740/assets/images/sshkeygen-15149528718779ff61c2d0f418e41d47.png" width="557" height="399" class="img_ev3q"></p><ol start="8"><li>Now issue the command to copy your public key to your account on <strong>deb3</strong></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Copy public key to deb3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id -i ~/.ssh/id_rsa.pub username@deb3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="9"><li>When prompted enter your password</li></ol><p><img loading="lazy" alt="sshcopyid" src="/OSL740/assets/images/sshcopyid-8b6f8a77ec11361ed8f7e91b1b47d287.png" width="1033" height="289" class="img_ev3q"></p><ol start="10"><li>Try using ssh to now log into your <strong>deb3</strong> VM from your <strong>deb2</strong> VM. What happens? Were you required to use your pass-phrase?</li></ol><p><img loading="lazy" alt="sshpki" src="/OSL740/assets/images/sshpki-9d68829d493cb909c7f3494f3ef2dd83.png" width="770" height="225" class="img_ev3q"></p><ol start="11"><li>Where was the Public key copied to? What file is it in?</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Display the authorized SSH keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ~/.ssh/authorized_keys</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This file contains the public keys that have been copied to your account</p><p><img loading="lazy" alt="deb3authkeys" src="/OSL740/assets/images/deb3authkeys-542d755b32840d4666e70cebffa94201.png" width="1034" height="133" class="img_ev3q"></p><ol start="12"><li>So now you can login to deb3 from our account on deb2 without needing a password.</li></ol><p><strong>Note:</strong> While you still do need to enter our passphrase to unlock the key, if you had left the passphrase blank then that wouldn&#x27;t have needed it. There are other tools available to help users manage and unlock keys.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-securely-running-graphical-applications-between-linux-servers">Part 2: Securely Running Graphical Applications Between Linux Servers<a class="hash-link" href="#part-2-securely-running-graphical-applications-between-linux-servers" title="Direct link to heading">​</a></h3><p>You can also use ssh to <strong>tunnel GUI applications (Window and bitmap information)</strong>, allowing us to login to a remote desktop host and <strong>run a Xwindows application</strong> such as <strong>gedit</strong> or <strong>Firefox</strong> and the application will run on the remote host but be displayed on the local host.</p><blockquote><p>Xorg (Xwindows, X11) is the longtime Graphical Server that has been used on Linux systems for many years. Regardless of the <strong>Desktop Environment</strong> you chose to install and use, (Gnome, KDE etc ) they all worked with XWindows.</p><p>A new graphical server has been developed that is starting to replace Xwindows called <strong>Wayland</strong>.
Many Linux distributions and some Desktop Environments now default to using Wayland as the Graphical Server.</p><p>Expect things to change quite quickly.</p></blockquote><p><img loading="lazy" alt="sshx" src="/OSL740/assets/images/sshx-0d4c723305dc0a14fd57ba1acc4a9164.png" width="515" height="271" class="img_ev3q"></p><p>You can use an SSH tunnel with options to allow running of applications on remote Linux servers.</p><p><strong>Perform the following steps:</strong></p><ol><li>For this section, you will be using your <strong>debhost</strong> and <strong>deb1</strong> VMs.</li><li>Switch to your debhost VM, open a terminal and remain logged in as a regular user.</li><li>Issue the following command to connect to your <strong>deb1</strong> VM:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -X -C username@deb1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(The <strong>-X</strong> option enables the forwarding of X window information, and the <strong>-C</strong> option enables compression for better performance).</li></ul><ol start="4"><li>Once the connection is properly established, run the command <code>gedit</code></li><li>The <em>gedit</em> window will display on your <strong>debhost</strong> VM, but in reality, this application is running on your <strong>deb1</strong> VM!</li><li>Enter some text and save the file as <strong>testfile</strong></li><li>Exit the <strong>gedit</strong> application.</li><li>On which host was the file saved? <strong>debhost</strong> or <strong>deb1</strong> What does that tell you about the use of tunneling for this section?</li><li>Logout of your ssh connection to <strong>deb1</strong></li><li>Connect again and run the <strong>gedit</strong> application by issuing only one Linux command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -X -C username@deb1 gedit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Note: ignore warning messages.</li></ul><ol start="11"><li>Exit the gedit application.</li><li>Experiment with running other GUI applications via <strong>ssh</strong> (They have to be applications installed on <strong>deb1</strong>).</li></ol><p><strong>Answer INVESTIGATION 2 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-3-managing-firewalls-for-protection-and-troubleshooting">Investigation 3: Managing Firewalls For Protection and Troubleshooting<a class="hash-link" href="#investigation-3-managing-firewalls-for-protection-and-troubleshooting" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-firewall-iptables-concepts">Linux Firewall (iptables) Concepts<a class="hash-link" href="#linux-firewall-iptables-concepts" title="Direct link to heading">​</a></h3><p>Since Linux servers can be connected to the Internet, it is very important to run a <strong>firewall</strong> to control what packets are allowed to enter and exit from the system. Also what packets might be forwarded to another computer or network. You will use the utility called <strong>iptables</strong> to set the firewall rules on a Linux server.</p><blockquote><p>The firewall software itself is in-kernel. It is called <strong>nftables</strong>.</p><p><strong>nftables</strong> replaces the older <strong>iptables</strong> and can be configured using the <strong>nft</strong> utility.
Debian implements the <strong>iptables</strong> utility as a &quot;wrapper&quot; for <strong>nft</strong>. This allows users and organizations with considerable investment in <strong>iptables</strong> configurations and knowledge to continue to use <strong>iptables</strong> syntax to configure <strong>nftables</strong>.</p></blockquote><p><img loading="lazy" alt="Chains" src="/OSL740/assets/images/Chains-85c8540e54b680d4e983ce44177a7a27.png" width="996" height="541" class="img_ev3q"></p><p><strong>iptables</strong> configurations consist of <strong>chains</strong> of <strong>policy rules</strong> that a <strong>packet</strong> must pass-through in order to either enter, leave, or be forwarded by the firewall. If a packet matches a rule, then an action is taken (some examples include: <strong>ACCEPT</strong>, <strong>DROP</strong>, <strong>REJECT</strong>, or <strong>LOG</strong>). If the packet passes through the chain of rules without a match, then the packet is directed to the chains default policy. (for example: <em>ACCEPT</em>, <em>REJECT</em>, or <em>DROP</em>).</p><p>You can create your own <strong>customized chains of rules</strong> but to keep thing simple, we only deal with 3 <strong>common predefined chains</strong>:</p><ul><li><strong>INPUT</strong>: Packets coming into current Linux server</li><li><strong>OUTPUT</strong>: Packets leaving current Linux server</li><li><strong>FORWARD</strong>: Packets being routed between Linux servers</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-listing-and-clearing-existing-iptables-rules">Part 1: Listing and Clearing Existing iptables Rules<a class="hash-link" href="#part-1-listing-and-clearing-existing-iptables-rules" title="Direct link to heading">​</a></h3><p>Let&#x27;s get some practice using the iptables command such as listing CHAIN rules, and clearing the CHAIN rules:</p><p><strong>Perform the following steps:</strong></p><ol><li>For the remainder of this section, use your <strong>debhost</strong> machine.</li><li>As working with the firewall requires elevated privileges start a sudo shell</li><li>Issue the following command to list the existing iptables policy rules:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># List all rules for all chains</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -L</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should see all kinds of rules organized into a number of chains. This is quite overwhelming but most of these rules were added when the <strong>libvirtd</strong> service was started during boot. <strong>libvirtd</strong> has to add rules that allow our VM&#x27;s to communicate over a virtual network.</p><p>For now we will shutoff our VM&#x27;s and disable <strong>libvirtd</strong> to simplify everything.</p><ol start="4"><li>Shutdown the <strong>deb1</strong>, <strong>deb2</strong>, and <strong>deb3</strong> VM&#x27;s</li><li>On <strong>debhost</strong> disable the <strong>libvirtd</strong> service and reboot</li><li>After rebooting open a terminal and start a sudo shell</li><li>Use the command above to list the iptables rules</li></ol><p><img loading="lazy" alt="debhostiptables1" src="/OSL740/assets/images/debhostiptables1-1e66efe47984827f51a3bcb020fb7be5.png" width="508" height="259" class="img_ev3q"></p><p>Notice that you have 3 default chains, <strong>INPUT</strong>, <strong>FORWARD</strong>, and <strong>OUTPUT</strong></p><ul><li>INPUT is the chain of rules for incoming packets</li><li>OUTPUT is the chain of rules for outgoing packets</li><li>FORWARD is the chain of rules for packets that are being routed to other hosts/networks by our host.</li></ul><p>Each of the chains has no current rules but they do have a default <strong>policy</strong> of <strong>ACCEPT</strong>
Which means that if none of the rules in the chain rejected the packet then it would be accepted.</p><p>A default <strong>policy</strong> of <strong>DROP</strong> would mean that if none of the rules accepted the packet then it would be dropped.</p><p><strong>Listing iptables Rules:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># List rules for all chains in the default table (filter)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -L</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># List rules for the INPUT chain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -L INPUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># List rules for the OUTPUT chain verbosely</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -v -L OUTPUT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="8"><li>Issue the iptables commands separately to display the rules for the <strong>OUTPUT</strong> chain and for the <strong>FORWARD</strong> chain.</li></ol><p><strong>Clearing (Flushing) iptables Rules:</strong></p><p>Sometimes it may be useful to completely clear the rules for all of a particular chain. Note the options that can be used to clear (or flush) the iptables rules,</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Flush the rules of all chains</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -F</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Flush the rules of the OUTPUT chain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -F OUTPUT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will have a chance to flush some rules later.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-setting-a-default-policy-and-setting-policy-exceptions-iptables">Part 2: Setting a Default Policy and Setting Policy Exceptions (iptables)<a class="hash-link" href="#part-2-setting-a-default-policy-and-setting-policy-exceptions-iptables" title="Direct link to heading">​</a></h3><p>You will now change the default policy of the <strong>INPUT</strong> chain to <strong>DROP</strong>. This means you will have add rules that allow specific types of packets in. A good way to think about setting policies is to have a &quot;<strong>safety-net</strong>&quot; to take some sort of action to prevent un-handled packets from passing through the firewall by mistake. After the default policy is set-up, then specific exceptions to the default policy can be added to control specific network traffic.</p><p>An example would be to set a default policy for incoming network traffic (INPUT chain) to DROP everything, and then set an exception certain exceptions (like ssh connections). Note the following table below for policy setting examples.</p><p><strong>Policy Setting Examples:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Drops all incoming packets regardless of protocol/ports/address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -P INPUT DROP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Accepts all outgoing packets regardless of protocol/ports/address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -P OUTPUT ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th align="left"><strong>iptables -P INPUT DROP</strong></th><th align="left">Drops all incoming packets regardless of protocol (eg. tcp, udp, icmp), port numbers (eg. 22, 80) or source or destination IP Addresses. Setting a default rule to DROP all incoming traffic would make it easier to specify a few exceptions.</th></tr></thead><tbody><tr><td align="left"><strong>iptables -P INPUT ACCEPT</strong></td><td align="left">Accepts all incoming packets regardless of protocol (eg. tcp, udp, icmp), port numbers (eg. 22, 80) or source or destination IP Addresses. It would seem that setting a default rule to ACCEPT all incoming traffic would require A LOT of exceptions to help &quot;lock-down&quot; the server for protection! The better practice is to use DROP as the default action, and only ACCEPT the traffic you actually want.</td></tr></tbody></table><p><strong>Perform the following steps:</strong></p><ol><li>Make certain you are in your <strong>debhost</strong> machine.</li><li>Issue the following Linux command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -P INPUT DROP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Issue the <strong>iptables -L</strong> command. Can you see the policy to DROP all incoming connections?</li><li>Open Firefox on debhost and attempt to connect to the internet. Although you have set a default policy to DROP all incoming connections, there is a problem: now, you cannot browse the Internet.</li></ol><p>In order to fix that problem, you can make an exception(rule) to allow incoming web-based traffic (requested via port 80). The iptables commands to create rules need to consider:</p><ul><li>What order are the rules in the chain? (order can be important)</li><li>Which protocol(s) are affected (eg. tcp, udp, icmp)</li><li>What source or destination IP Addresses are affected?</li><li>What port numbers are affected?</li><li>What action(target) to take if all of the above conditions are met? (eg. ACCEPT, REJECT, DROP, or LOG)</li></ul><p><strong>iptables Command Structure for setting rules</strong></p><p>Examples:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Append a rule to the INPUT chain allowing incoming ssh traffic from the local network only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT --dport </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -p tcp -s </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.245.0/24 -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Append a rule to the INPUT chain allowing all incoming packets to the loopback interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -i lo -p all -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Insert a rule into 2nd position of the INPUT chain to allow incoming traffic related to established connections</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Insert a rule into 1st postition of the INPUT chain to allow incoming pings (icmp) from the local network only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> INPUT -p icmp -s </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.245.0/24 -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th align="left">Placement in Chain</th><th align="left">Chain Name</th><th align="left">Specify Protocol</th><th align="left">Source/Destination</th><th align="left">Target</th></tr></thead><tbody><tr><td align="left"><strong>-A</strong> (add / Append to bottom of chain)</td><td align="left"><strong>INPUT</strong></td><td align="left"><strong>-p tcp</strong> (tcp packets)</td><td align="left"><strong>-s IPADDR</strong> (source host or network address)</td><td align="left"><strong>-j DROP</strong></td></tr><tr><td align="left"><strong>-I 2</strong> (insert into 2nd position)</td><td align="left"><strong>OUTPUT</strong></td><td align="left"><strong>-p udp</strong> (udp packets)</td><td align="left"><strong>-d IPADDR</strong> (destination host or network address)</td><td align="left"><strong>-j ACCEPT</strong></td></tr><tr><td align="left"><strong>-R 2</strong> (replace the 2nd rule)</td><td align="left"><strong>FORWARD</strong></td><td align="left"><strong>-p icmp</strong></td><td align="left"><strong>-i ens33</strong> (interface name)</td><td align="left"><strong>-j LOG</strong> (accept packet but record in logs)</td></tr><tr><td align="left"><strong>-D 3</strong> (delete rule 3)</td><td align="left"></td><td align="left"><strong>-p all</strong></td><td align="left"><strong>--dport 22</strong> (destination port number)</td><td align="left"><strong>-j REJECT</strong> (reject with error)</td></tr><tr><td align="left"></td><td align="left"></td><td align="left"><strong>-p tcp,udp,icmp</strong> (combined)</td><td align="left"><strong>--sport 53</strong> (source port numner)</td><td align="left"></td></tr><tr><td align="left"></td><td align="left"></td><td align="left">(refer to <strong>/etc/protocols</strong> )</td><td align="left">(refer to <strong>/etc/services</strong>)</td><td align="left"></td></tr></tbody></table><ol start="5"><li>Issue the following Linux command to ensure the loopback interface is not affected by these rules. The computer needs to be able to communicate with itself with any state and protocol:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -i lo -p all -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Issue the following Linux command to ensure the system can get responses to traffic it sends out:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li><p>Use Firefox on <strong>debhost</strong> to connect to the Internet your other web-browser to confirm that you can now browse the Internet. Because the incoming traffic is a response related to my established connection it is accepted.</p></li><li><p>Determine the external facing ip address of <strong>debhost</strong></p></li><li><p>Using your Windows machine running VMware (or another machine in your network if you did a bare-metal installation for debhost) try to ping that external facing address. Were you successful?</p></li><li><p>Issue the following iptables command to allow incoming ping packets (icmp) from only the address of your Windows host. (You will have to use your own IP address)</p></li></ol><p>My VMware host IP:
<img loading="lazy" alt="winhostip" src="/OSL740/assets/images/winhostip-2316e0274f4f00784aa240647278452a.png" width="791" height="212" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -p icmp -s </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.213.1 -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="11"><li>Repeat pinging your debhost&#x27;s external facing IP Address. What happened? Why?</li></ol><p><img loading="lazy" alt="iptablesping" src="/OSL740/assets/images/iptablesping-4f2802962d91c97a14031b12ea8ab771.png" width="611" height="92" class="img_ev3q"></p><ol start="12"><li>Try to SSH into YOUR debhost. Were you Successful?</li><li>Issue the following Linux command to append a rule to the INPUT chain to allow incoming ssh traffic (ie. port 22):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -p tcp --dport </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="14"><li>Issue an iptables command to confirm that there is a rule to handle incoming tcp packets using port 22.</li><li>Try to SSH into your debhost (at least to get a password prompt). Were you Successful? If so, why?</li><li>Note that the rule we entered would allow <strong>anyone</strong> who can reach your debhost to try to log in with ssh. This is <strong>not</strong> a good idea. What would you have to change about that rule to only allow the one machine you are connecting from?</li><li>Reboot <strong>debhost</strong> open a terminal and start a sudo shell.</li><li>List the iptables rules for the INPUT chain. What happened to your iptables rules for the INPUT chain?</li><li>Proceed to the next part to learn how to learn how to make your iptables rules persistent.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-making-iptables-policies-persistent">Part 3: Making iptables Policies Persistent<a class="hash-link" href="#part-3-making-iptables-policies-persistent" title="Direct link to heading">​</a></h3><p>Any changes to your iptables rules will be lost when you restart your Linux server, unless you make your iptables rules persistent. Failure to perform the following steps after setting up your firewall rules can cause confusion and wasted time.</p><p><strong>Don&#x27;t save copies of rules that libvirtd will auto-add every boot.</strong></p><p>When the libvirtd service starts on debhost it adds some rules to iptables to allow the machines in your virtual network communicate with each other and the outside world. We don&#x27;t want to include these rules in our configuration because it will cause the rules to be loaded twice. This won&#x27;t actually break anything, but it does clutter up your iptables and make them harder to read. Before you continue with this investigation, confirm that there are no rules currently loaded.</p><p><strong>Perform the following steps:</strong></p><ol><li>Make sure that no rules are currently loaded</li><li>Set the default <strong>policy</strong> for both the <strong>INPUT</strong> and <strong>FORWARD</strong> chains to <strong>DROP</strong></li><li>Append rules to the <strong>INPUT</strong> chain that allow SSH traffic from your Windows host and from the <strong>192.168.245.0/24</strong> network.</li><li>Append a rule to the <strong>INPUT</strong> chain to allow <strong>icmp</strong> traffic from your <strong>192.168.245.0/24</strong> network.</li><li>Append a rule to the <strong>INPUT</strong> chain to allow all traffic to the <strong>lo</strong> (loopback) interface.</li><li>Append a rule to the <strong>INPUT</strong> chain to allow all traffic that is <strong>RELATED</strong>/<strong>ESTABLISHED</strong>.</li><li>List the <strong>INPUT</strong> chain. It should look similar to this</li></ol><p><img loading="lazy" alt="iptables3" src="/OSL740/assets/images/iptables3-21f24fc039ebcaa482b44475fab06528.png" width="1046" height="193" class="img_ev3q"></p><ol start="8"><li>Test your rules by doing the following:</li></ol><ul><li>ssh from your Windows host to the external ip address of <strong>debhost</strong></li><li>Open Firefox on <strong>debhost</strong> and connect to a website on the Internet</li><li>On <strong>debhost</strong> ping the loopback address <strong>127.0.0.1</strong></li></ul><p>You can&#x27;t test the traffic from <strong>192.168.245.0/24</strong> until <strong>libvirtd</strong> starts. Before you start <strong>libvirtd</strong> you should save your current rules to make them persistent.</p><ol start="9"><li>Save the current ruleset using the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Save iptables rules in memory to a file in the correct format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables-save -f /etc/iptables.rules</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="10"><li>Verify that the file <strong>/etc/iptables.rules</strong> exists.</li><li>Create a new script file <strong>/etc/network/if-pre-up.d/iptables</strong></li><li>Add the following to the file</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/sbin/iptables-restore /etc/iptables.rules</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="13"><li>Make the script executable <code>chmod u+x /etc/network/if-pre-up.d/iptables</code></li><li>Reboot <strong>debhost</strong> and check that the rules are restored during boot.</li><li>Start the <strong>libvirtd</strong> service, and note the rules it adds to your iptables. It will do this automatically every time it starts.</li><li>Enable the <strong>libvirtd</strong> service so that it starts during boot.</li><li>After rebooting open a terminal and start a sudo shell</li><li>List your iptables rules. If everything there?</li><li>Start your <strong>deb1</strong>, <strong>deb2</strong>, and <strong>deb3</strong> VM&#x27;s</li><li>Confirm that you can ping <strong>debhost</strong> and that you can connect to <strong>debhost</strong> using <strong>ssh</strong>, from each of your VM&#x27;s</li></ol><p><strong>Answer INVESTIGATION 3 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-7-sign-off-show-instructor">Lab 7 Sign-Off (Show Instructor)<a class="hash-link" href="#lab-7-sign-off-show-instructor" title="Direct link to heading">​</a></h2><p>Follow the submission instructions for lab 7 on Blackboard.</p><p><strong>Time for a new backup and system updates!</strong></p><p>If you have successfully completed this lab, make a new backup of your virtual machines as well as your host machine.</p><p><strong>Perform the Following Steps:</strong></p><ol><li>Make certain ALL of your VMs are running.</li><li>Make sure you are connected to Seneca&#x27;s VPN on your Windows host.</li><li>Switch to your <strong>debhost</strong> VM and change to your user&#x27;s <strong>bin</strong> directory.</li><li>Issue the Linux command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://raw.githubusercontent.com/jmcarman/osl740-debian-labs/main/lab7-check.bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Give the <strong>lab7-check.bash</strong> file execute permissions (for the file owner).</li><li>Run the shell script and if there are any warnings, make fixes and re-run shell script until you receive &quot;Congratulations&quot; message.</li><li>Upload a screenshot of proof from the previous step to Blackboard, as per your Professor&#x27;s instructions.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="practice-for-quizzes-tests-midterm-and-final-exam">Practice For Quizzes, Tests, Midterm, and Final Exam<a class="hash-link" href="#practice-for-quizzes-tests-midterm-and-final-exam" title="Direct link to heading">​</a></h2><ol><li>What port does sshd use by defaults?</li><li>What file is used to configure sshd?</li><li>What kind of files are stored in the &quot;~/.ssh/&quot; directory?</li><li>How do you determine whether the ssh service is running on your system or not?</li><li>What is the purpose of the ~/.ssh/known_hosts file?</li><li>What is the purpose of the ~/.ssh/authorized_keys file?</li><li>How do you stop the ssh service?</li><li>How do you tunnel XWindows applications?</li><li>What port is the default ssh port?</li><li>What port(s) is/are used by httpd service?</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/OSL740/tree/main/docs/A-Labs/lab7.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/OSL740/A-Labs/lab6"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 6</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/OSL740/A-Labs/lab8"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 8</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lab-preparation" class="table-of-contents__link toc-highlight">Lab Preparation</a><ul><li><a href="#purpose-and-objectives-of-lab-7" class="table-of-contents__link toc-highlight">Purpose and Objectives of Lab 7</a></li><li><a href="#minimum-required-materials" class="table-of-contents__link toc-highlight">Minimum Required Materials</a></li><li><a href="#linux-command-reference" class="table-of-contents__link toc-highlight">Linux Command Reference</a></li></ul></li><li><a href="#investigation-1-installing-and-maintaining-an-ssh-server" class="table-of-contents__link toc-highlight">Investigation 1: Installing And Maintaining An SSH Server</a><ul><li><a href="#part-1-confirming-sshd-service-is-running-on-vms" class="table-of-contents__link toc-highlight">Part 1: Confirming sshd service is Running on VMs.</a></li><li><a href="#part-2-ssh-server-security-configuration" class="table-of-contents__link toc-highlight">Part 2: SSH Server Security Configuration</a></li></ul></li><li><a href="#investigation-2-additional-methods-to-secure-your-ssh-server" class="table-of-contents__link toc-highlight">Investigation 2: Additional Methods To Secure Your SSH Server</a><ul><li><a href="#part-1-generating-private-and-public-keys-public-key-infrastructure" class="table-of-contents__link toc-highlight">Part 1: Generating Private and Public Keys (Public Key Infrastructure)</a></li><li><a href="#part-2-securely-running-graphical-applications-between-linux-servers" class="table-of-contents__link toc-highlight">Part 2: Securely Running Graphical Applications Between Linux Servers</a></li></ul></li><li><a href="#investigation-3-managing-firewalls-for-protection-and-troubleshooting" class="table-of-contents__link toc-highlight">Investigation 3: Managing Firewalls For Protection and Troubleshooting</a><ul><li><a href="#linux-firewall-iptables-concepts" class="table-of-contents__link toc-highlight">Linux Firewall (iptables) Concepts</a></li><li><a href="#part-1-listing-and-clearing-existing-iptables-rules" class="table-of-contents__link toc-highlight">Part 1: Listing and Clearing Existing iptables Rules</a></li><li><a href="#part-2-setting-a-default-policy-and-setting-policy-exceptions-iptables" class="table-of-contents__link toc-highlight">Part 2: Setting a Default Policy and Setting Policy Exceptions (iptables)</a></li><li><a href="#part-3-making-iptables-policies-persistent" class="table-of-contents__link toc-highlight">Part 3: Making iptables Policies Persistent</a></li></ul></li><li><a href="#lab-7-sign-off-show-instructor" class="table-of-contents__link toc-highlight">Lab 7 Sign-Off (Show Instructor)</a></li><li><a href="#practice-for-quizzes-tests-midterm-and-final-exam" class="table-of-contents__link toc-highlight">Practice For Quizzes, Tests, Midterm, and Final Exam</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">OSL740 - Administration of Open Source Systems</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/OSL740/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Seneca College.</div></div></div></footer></div>
<script src="/OSL740/assets/js/runtime~main.6b6f3019.js"></script>
<script src="/OSL740/assets/js/main.8404b104.js"></script>
</body>
</html>