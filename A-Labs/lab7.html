<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-A-Labs/lab7">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/OSL740/img/pwa/icon-512x512.png">
<link rel="manifest" href="/OSL740/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/OSL740/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/OSL740/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/OSL740/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Lab 7 | OSL740 - Administration of Open Source Systems</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 7 | OSL740 - Administration of Open Source Systems"><meta data-rh="true" name="description" content="Lab 7 for Students to Complete and Submit"><meta data-rh="true" property="og:description" content="Lab 7 for Students to Complete and Submit"><link data-rh="true" rel="icon" href="/OSL740/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab7" hreflang="x-default"><link rel="stylesheet" href="/OSL740/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/OSL740/assets/js/runtime~main.e8ac8b46.js" as="script">
<link rel="preload" href="/OSL740/assets/js/main.90f2afc0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/OSL740/"><div class="navbar__logo"><img src="/OSL740/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/OSL740/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OSL740 - Administration of Open Source Systems</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OSL740/">Welcome to OSL740</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OSL740/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/OSL740/A-Labs/lab1">Labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab1">Lab 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab2">Lab 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab3">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab4">Lab 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab5">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab6">Lab 6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/OSL740/A-Labs/lab7">Lab 7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab8">Lab 8</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OSL740/B-Assignments/assignment1">Assignments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OSL740/C-ExtraResources/tips">Extra Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/OSL740/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Labs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 7</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 7: Setup and Configure SSH</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-preparation">Lab Preparation<a class="hash-link" href="#lab-preparation" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="purpose-and-objectives-of-lab-7">Purpose and Objectives of Lab 7<a class="hash-link" href="#purpose-and-objectives-of-lab-7" title="Direct link to heading">​</a></h3><p>Setting up a computer network is very important, but the Linux system administrator must also perform networking maintenance which includes <strong>trouble-shooting, repairing network connection issues</strong> and <strong>maintaining network security</strong>. System administrators need to <strong>protect or &quot;harden&quot; their computer networks from &quot;penetration&quot; from unauthorized computer users</strong>. Hardening a computer system can range from running an <strong>IDS</strong> (Intrusion Detection System) to monitoring and flagging suspicious activity to implementing security policies which could range from running firewalls to setting locked screen savers on workstations.</p><p>In this lab, you will learn how to install and configure the SSH service on a VM to allow users to securely access and share data between authorized personnel. In addition, you will learn various methods of running and configuring an ssh server which include: using <strong>Public Key Authentication</strong>, setting up an <strong>SSH tunnel</strong> in order to securely run graphical applications safely among computers in the network, and <strong>disabling root login</strong> into a Linux machine. You will also learn how to set up a firewall using the <strong>iptables</strong> command in order to control the flow of packets throughout your computer server.</p><p><img loading="lazy" alt="Firewall" src="/OSL740/assets/images/Firewall-47ee633533b09162d89becea33f4d978.png" width="232" height="237" class="img_ev3q"></p><p>Protecting a computer network from unauthorized access is one of the many day-to-day operations for a Linux system administrator and/or security specialist</p><p><strong>Main Objectives</strong></p><ol><li><p>To use the <strong>ssh</strong> and <strong>scp</strong> to access and copy data among Linux servers in a secure manner</p></li><li><p>Set up, configure, and start the Secure Shell Service (<strong>sshd</strong>)</p><ul><li>To refuse root login from remote Linux servers or limit users that are permitted to ssh into Linux servers</li></ul></li><li><p>Generate Public and Private keys to ensure secure connections between Linux servers</p></li><li><p>Use ssh to <strong>tunnel Xwindow applications</strong></p></li><li><p>Learn about the Linux firewall (via iptables):</p><ul><li>Use <strong>iptables</strong> command used to configure and maintain a firewall for protection and troubleshooting</li><li>Configure <strong>iptables</strong> to set a default policy and add exceptions to the default policy</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minimum-required-materials">Minimum Required Materials<a class="hash-link" href="#minimum-required-materials" title="Direct link to heading">​</a></h3><ul><li><strong>Solid State Drive</strong></li><li><strong>USB key</strong> (for backups)</li><li><strong>Lab7 Log Book</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-command-reference">Linux Command Reference<a class="hash-link" href="#linux-command-reference" title="Direct link to heading">​</a></h3><p><strong>Networking Utilities</strong></p><table><thead><tr><th><a href="http://man7.org/linux/man-pages/man1/ssh.1.html" target="_blank" rel="noopener noreferrer">ssh</a></th><th><a href="http://man7.org/linux/man-pages/man1/ssh-keygen.1.html" target="_blank" rel="noopener noreferrer">ssh-keygen</a></th><th><a href="http://linux.die.net/man/1/ssh-copy-id" target="_blank" rel="noopener noreferrer">ssh-copy-id</a></th><th><a href="http://man7.org/linux/man-pages/man1/scp.1.html" target="_blank" rel="noopener noreferrer">scp</a></th><th><a href="http://man7.org/linux/man-pages/man1/sftp.1.html" target="_blank" rel="noopener noreferrer">sftp</a></th><th><a href="http://man7.org/linux/man-pages/man8/ss.8.html" target="_blank" rel="noopener noreferrer">ss</a></th><th><a href="http://man7.org/linux/man-pages/man8/ip.8.html" target="_blank" rel="noopener noreferrer">ip</a></th><th><a href="http://man7.org/linux/man-pages/man8/ping.8.html" target="_blank" rel="noopener noreferrer">ping</a></th><th><a href="http://man7.org/linux/man-pages/man8/arp.8.html" target="_blank" rel="noopener noreferrer">arp</a></th><th><a href="http://zenit.senecac.on.ca/wiki/index.php/IPTables" target="_blank" rel="noopener noreferrer">iptables</a></th></tr></thead></table><p><strong>Additional Utilities</strong></p><ul><li><a href="http://man7.org/linux/man-pages/man7/hostname.7.html" target="_blank" rel="noopener noreferrer">hostname</a></li><li><a href="http://linux.die.net/man/8/restorecon" target="_blank" rel="noopener noreferrer">restorecon</a></li></ul><p><strong>Managing Services</strong></p><ul><li><a href="http://www.dsm.fordham.edu/cgi-bin/man-cgi.pl?topic=systemctl" target="_blank" rel="noopener noreferrer">systemctl</a></li></ul><p><strong>Configuration Files</strong></p><ul><li><a href="https://www.freebsd.org/cgi/man.cgi?query=ssh_config&amp;sektion=5" target="_blank" rel="noopener noreferrer">ssh_config</a></li><li><a href="https://www.freebsd.org/cgi/man.cgi?sshd_config(5)" target="_blank" rel="noopener noreferrer">sshd_config</a></li></ul><p><strong>SSH Reference</strong></p><ul><li><a href="http://support.suso.com/supki/SSH_Tutorial_for_Linux" target="_blank" rel="noopener noreferrer">A good ssh tutorial</a></li><li><a href="http://it.toolbox.com/blogs/locutus/shh-securing-ssh-howto-10640" target="_blank" rel="noopener noreferrer">A good HOW-TO to make ssh more secure</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-1-installing-and-maintaining-an-ssh-server">Investigation 1: Installing And Maintaining An SSH Server<a class="hash-link" href="#investigation-1-installing-and-maintaining-an-ssh-server" title="Direct link to heading">​</a></h2><p>So far, you have learned to use the <strong>ssh</strong> utility to establish a secure connection to a remote server in order to perform Linux administration tasks. You have issued the ssh command, which is actually the <strong>client</strong> application for ssh. In order to connect to a remote server (like your VMs, Matrix, etc) it needs to run the <strong>SSH service</strong> (i.e. the <strong>ssh daemon</strong>).</p><p>In this section, you will learn how to configure an SSH server and restart the ssh service for an existing VM. You will also learn how to configure, restart, and use SSH in order to create secure connections between your Linux machines (host as well as VMs).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-confirming-sshd-service-is-running-on-vms">Part 1: Confirming sshd service is Running on VMs.<a class="hash-link" href="#part-1-confirming-sshd-service-is-running-on-vms" title="Direct link to heading">​</a></h3><p><strong>Perform the following steps:</strong></p><p>Some tasks in this part of the investigation <strong>require you to be connected to Seneca&#x27;s VPN</strong>.</p><ul><li><p>If you are running your installation through VMWare, then you can use the <a href="https://students.senecacollege.ca/spaces/186/it-services/wiki/view/1025/student-vpn" target="_blank" rel="noopener noreferrer">instructions provided by ITS</a> to connect to it from your Windows machine (your c7host and its nested VMs will use the VPN through the windows machine without further configuration).</p></li><li><p>If you installed your c7host <strong>directly onto a machine without using VMWare</strong> as an intermediary (or the steps above do not work for you), use the following instructions:</p><ul><li>Install the package openconnect</li><li>Run the following command as root (or with sudo): <code>openconnect --protocol=gp studentvpn.senecacollege.ca -b</code></li><li>This should prompt you for your username and password (you could also put the user name in the command with -p)</li><li>You&#x27;ll know it is working if you check your ip address and see something in the 10.0.0.0/8 range.</li><li>To disconnect, as root (or with sudo): <code>killall openconnect</code></li></ul></li></ul><p>Once you have connected to the VPN with either method you may continue</p><ol><li>Launch your <strong>c7host machine</strong> and your <strong>centos1</strong> and <strong>centos3</strong> VMs.</li><li>Switch to your <strong>c7host</strong> VM.</li><li>Create a file in your current directory of your c7host machine with some text in it called: <strong>myfile.txt</strong></li><li>Issue the following command (using your Matrix login id):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">scp</span><span class="token plain"> myfile.txt yourmatrixid@matrix.senecacollege.ca:/home/yourmatrixid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(followed by your Matrix password)</li><li>What did this command do?</li></ul><ol start="5"><li>Issue the following single command (arguments are separated by a space - use your Matrix login id):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> yourmatrixid@matrix.senecacollege.ca </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> /home/yourmatrixid/myfile.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(followed by your Matrix password)</li><li>What did this command do?</li><li>Issue the following Linux command:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> yourmatrixid@matrix.senecacollege.ca </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /home/yourmatrixid/myfile.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>How do these commands differ from using issuing the ssh command without the ls or cat command? How is this useful?</li><li>The client ssh application contains the utlities: <strong>ssh</strong>, <strong>scp</strong> and <strong>sftp</strong> (learned in ULI101) to connect to remote Linux servers in order to issue commands or transfer files between Linux servers. You can install the SSH service on your Linux server, although this has already been performed upon installation. We will now confirm that the ssh service is running on all of your VMs.</li></ul><ol start="6"><li>OpenSSH should have been installed by default. Let&#x27;s confirm this by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -qa </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>You should see a number of packages installed including <strong>openssh-clients</strong> and <strong>openssh-server</strong></li><li>The <strong>openssh-server</strong> package installs a service called <strong>sshd</strong>.</li><li>Confirm that this service is running by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status sshd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="10"><li>Now that you know the service is running, investigate what <strong>port number</strong> and <strong>protocol</strong> sshd uses by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ss -atunp </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">more</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>What protocol and port is the sshd process using? What is the state of the port? Why would you think that UDP ports don&#x27;t have a state?</li></ul><ol start="11"><li>Reissue the <code>ss</code> command without the <strong>-n</strong> option. What is the difference?</li><li>You can refer to the <strong>/etc/services</strong> file in order to determine a port number for a service. Issue the following command to confirm that port 22 is associated with ssh:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> /etc/services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="13"><li>Make sure the <strong>sshd</strong> service is running on <strong>all 3 of your VM&#x27;s</strong></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-ssh-server-security-configuration">Part 2: SSH Server Security Configuration<a class="hash-link" href="#part-2-ssh-server-security-configuration" title="Direct link to heading">​</a></h3><p>Any time that you configure your computer to allow logins from the network you are leaving yourself <strong>vulnerable to potential unauthorized access</strong> by penetration testers or even hackers. Running the sshd service is a fairly common practice but care must be taken to make things more difficult for those individuals that attempt to use <strong>brute force attacks</strong> to gain access to your system. Hackers use their knowledge of your system and can use <strong>password guessing programs</strong> help to gain access. They know which port is likely open to attack (TCP:22), the administrative account name (root).</p><p>The Linux system administrator can <strong>configure the SSH server</strong> in order to make the SSH server less vulnerable to attacks. Examples include not permitting root login, and changing the default port number for the ssh service.</p><p><strong>Perform the following steps:</strong></p><ol><li><p>For this section, you will still be using your <strong>c7host</strong> and <strong>centos1</strong> VMs.</p><ul><li>The next change you can make is to prevent the root account from logging in to sshd altogether.</li></ul></li><li><p>Change to your <strong>centos1</strong> VM and open a terminal.</p></li><li><p>Edit the file <strong>/etc/ssh/sshd_config</strong> (you will need elevated privileges to do so) and look for the option <code>PermitRootLogin</code>. <strong>Un-comment the option</strong> (or add the option if it does not appear) and change the option value to <code>no</code>.</p><ul><li><strong>NOTE</strong>: Now any hacking attempt also has to guess an account name as well as the password. If you need root access on the machine you ssh to, ssh as a regular user and then use <strong>sudo</strong>, just like on a local machine.</li></ul></li><li><p>Even better, it is possible to restrict access to just specific users that require it:</p><ul><li>Edit the file <strong>/etc/ssh/sshd_config</strong> and <strong>add</strong> a new option of <code>AllowUsers yourAccountName</code> (where &quot;yourAccountName&quot; is your regular user accountname for your centos1 VM)</li></ul></li><li><p>In order for these changes to take affect, you need to restart the sshd daemon. Issue the following command to restart the <strong>sshd</strong> service:</p></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart sshd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Try SSHing from your <strong>c7host</strong> VM to your <strong>centos1</strong> VM as <strong>root</strong>. Where you successful?</li><li>Try SSHing from your c7host VM to your centos1 VM as your regular user accountname. Did it work?</li><li>Create another regular user on centos1 called: <strong>other</strong></li><li>Set the password for the newly-created called <strong>other</strong></li><li>Try SSHing from your c7host VM to your centos1 VM for the account called <strong>other</strong>. Why didn&#x27;t it work?</li><li>Edit the file <strong>/etc/ssh/sshd_config</strong> to add the account <strong>other</strong> for the <strong>AllowUsers</strong> option (use a space to separate usernames instead of a comma).</li><li>Restart the ssh service.</li><li>Try SSHing from your c7host VM to your centos1 VM for the account called <strong>other</strong>. Did it work this time?</li><li>Issue the following command to make a backup copy of your sshd_config file to your original regular user&#x27;s home directory:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /etc/ssh/sshd_config /home/regularuserid/sshd_config.bk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="15"><li>Issue the following command to allow same group and other group members to view the file contents:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> og+r /home/regularuserid/sshd_config.bk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="16"><li>Finally, as a system administrator, you should periodically monitor your system logs for unauthorized login attempts.</li><li>On CentOS systems the log file that is used is <strong>/var/log/secure</strong></li><li>This is the same file that logs all uses of the <strong>su</strong> and <strong>sudo</strong> commands.</li><li>Attempt to connect to all of your VM&#x27;s as root and other users using both public key and password authentication. Use some <strong>su</strong> and <strong>sudo</strong> commands also.</li><li>Inspect the log to see what kind of information is logged.</li></ol><p><strong>Answer INVESTIGATION 1 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-2-additional-methods-to-secure-your-ssh-server">Investigation 2: Additional Methods To Secure Your SSH Server<a class="hash-link" href="#investigation-2-additional-methods-to-secure-your-ssh-server" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-generating-private-and-public-keys-public-key-infrastructure">Part 1: Generating Private and Public Keys (Public Key Infrastructure)<a class="hash-link" href="#part-1-generating-private-and-public-keys-public-key-infrastructure" title="Direct link to heading">​</a></h3><p>As a system administrator, you have the ability to generate or create <strong>public</strong> and <strong>private</strong> keys to ensure safe and secure ssh connections. This will require a user to prove who they say they are in order to access a Linux server via SSH (i.e. <strong>authentication</strong>). The system administer can generate these keys for the first time, or if the system administrator suspects that a hacker has compromised or trying to penetrate the server, they can remove the existing keys and generate new keys.</p><p>A common type of attack, <strong>Arp Poisoning (Man in the Middle Attack)</strong>, can be used to redirect packets to a third party while maintaining the illusion that the connection is secure. Therefore, understanding about the generation and management of public/private keys are important to the security of servers.</p><p><strong>Storing Fingerprints</strong></p><p>When a user connects to a host using ssh, the host sends a fingerprint or digital signature to the client to establish its identity. The first time a connection is established the identity must be stored for subsequent connections. The fingerprints are stored separately for each user in a file called <code>~/.ssh/known_hosts</code> .</p><p>From now on when you connect to that host the client will compare the received fingerprint against the list of known hosts before connecting. If the fingerprint does not match it could indicate somebody had setup a system to impersonate the computer you wish to connect.</p><p><strong>Perform the following steps:</strong></p><ol><li><p>Switch to your <strong>centos3</strong> VM.</p><ul><li>We can use the <strong>ss</strong> utility as a trouble-shooting tool to view the SSH service and determine which STATE the SSH service is performing: <strong>LISTENING, ESTABLISHED, CLOSED</strong> , or <strong>WAITING</strong></li></ul></li><li><p>Run the <strong>ss -atunp</strong> command (pipe to &quot;grep sshd&quot;) to check the state of a possible <em>ssh connection</em>. What is the state (i.e. LISTENING or ESTABLISHED)?</p></li><li><p>While in your <strong>centos3</strong> VM, issue the following command to connect to <strong>your same VM</strong> via ssh: <code>ssh osl740@centos3</code></p></li><li><p>Enter yes at the prompt, and enter your OSL740 password. The output should appear similar as what is shown below:</p></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;centos3 (192.168.245.13)&#x27;</span><span class="token plain"> can</span><span class="token string" style="color:#e3116c">&#x27;t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">RSA key fingerprint is 53:b4:ad:c8:51:17:99:4b:c9:08:ac:c1:b6:05:71:9b.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Are you sure you want to continue connecting (yes/no)? yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Warning: Permanently added &#x27;</span><span class="token plain">centos3&#x27; </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RSA</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> to the list of known hosts.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>Issue the following command to confirm that you connected to your centos3 VM: <code>hostname</code></li><li>Re-run that same <strong>ss pipeline command</strong>. Any change to the connection status?</li><li>Log-out of your ssh connection by typing <code>exit</code>.</li><li>Run that same <strong>ss</strong> command again. Wait a few minutes and then check again. Record your observations.</li></ol><p>So far, we have learned to establish an ssh connection to another host using a password to establish your identity. But <strong>passwords are not the only or even the best way of authenticating your identity</strong>. We can also use <strong>Public/Private key encryption</strong>.</p><p><strong>Public Key authentication</strong> is a method of establishing identity using a <strong>pair of encryption keys that are designed to work together</strong>. One key is known as your <strong>private key</strong> (which as the name suggests should remain private and protected) and the other is known as the <strong>public key</strong> (which as the name suggests can be freely distributed) The keys are designed to work together to encrypt data asymmetrically, that is to say that when we <strong>encrypt data with one of the keys it can only be decrypted with the other key</strong> from the pair.</p><p>While it doesn&#x27;t mean the message is secure as anybody could decrypt it with the public key, it does establish my identity, if the host can successfully decrypt the message then it must have come from the one person in possession of the private key.</p><p><img loading="lazy" alt="Spoof" src="/OSL740/assets/images/Spoof-33a214307013854d9d325b6da862c8c2.png" width="510" height="268" class="img_ev3q"></p><p>If you ever receive a message like the one displayed above, you should investigate why it is happening as it could indicate a <strong>serious security issue</strong>, or it could just mean that something on <strong>the host has changed</strong> (i.e. the OS was reinstalled)</p><ol start="9"><li>Switch to your <strong>centos2</strong> VM.</li><li>Confirm you are in your centos2 VM by entering the command: <code>hostname</code></li><li>Make certain that you are in your centos2 VM and that you are logged in as a <strong>regular user</strong> (i.e. NOT root!) (you have been warned!)</li><li>To generate a keypair (public/private keys), issue the following command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="13"><li><p>After generating the keys it prompts you for the location to save the keys. The default is <strong>~/.ssh</strong> Your private key will be saved as <strong>id_rsa</strong> and your public key will be saved as <strong>id_rsa.pub</strong>. Press ENTER to accept the default.</p></li><li><p>You will then be prompted for a <strong>pass-phrase</strong>. The pass-phrase must be entered in order to use your private key. Pass-phrases are more secure than passwords and should be lengthy, hard to guess and easy to remember. For example one pass-phrase that meets this criteria might be &quot;<em>seneca students like to dance at 4:00am</em>&quot;. Avoid famous phrases such as &quot;<em>to be or not to be</em>&quot; as they are easy to guess. It is possible to leave the pass-phrase blank but this is dangerous. It means that if a hacker were able to get into your account they could then use your private key to access other systems you use.</p><ul><li>The output should appear similar to what is shown below:</li></ul></li></ol><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Generating public/private rsa key pair.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter file in which to save the key (/home/yoursenecaid/.ssh/id_rsa): </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter passphrase (empty for no passphrase):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter passphrase again:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your public key has been saved in /home/yoursenecaid/.ssh/id_rsa.pub.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key fingerprint is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ef:de:31:67:f7:15:a4:43:39:15:5d:78:1b:e8:97:74 yoursenecaid@centos2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The key&#x27;s randomart image is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--[ RSA 2048]----+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|              .+=|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|             .+oE|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|            .+.o=|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|            ..++ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|        S    o.. |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         .    . .|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|          . o o o|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         . . = .o|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|         .o .   .|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+-----------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="15"><li>Now issue the command</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id -i ~/.ssh/id_rsa.pub osl740@centos3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="16"><li>When prompted for password, enter OSL740&#x27;s password</li><li>Try using ssh to now log into your <strong>centos3</strong> VM from your <strong>centos2</strong> VM. What happens? Were you required to use your pass-phrase?</li><li>Issue the <strong>hostname</strong> command to verify that you are successfully logged into your <strong>centos3</strong> VM.</li><li>Make certain to logout of your <strong>centos3</strong> system. Use the <strong>hostname</strong> command to verify you are back in your centos2 server.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-securely-running-graphical-applications-between-linux-servers">Part 2: Securely Running Graphical Applications Between Linux Servers<a class="hash-link" href="#part-2-securely-running-graphical-applications-between-linux-servers" title="Direct link to heading">​</a></h3><p>You can also use ssh to <strong>tunnel window and bitmap information</strong>, allowing us to login to a remote desktop host and <strong>run a Xwindows application</strong> such as <strong>gedit</strong> or <strong>firefox</strong> and the application will run on the remote host but be displayed on the local host.</p><p><img loading="lazy" alt="Tunel Gedit" src="/OSL740/assets/images/Tunel-gedit-2a25774ddccb5f1d6776e9d42f2c4ab3.png" width="614" height="389" class="img_ev3q"></p><p>You can use an SSH tunnel with options to allow running of applications on remote Linux servers.</p><p><strong>Perform the following steps:</strong></p><ol><li>For this section, you will be using your <strong>c7host</strong> and <strong>centos1</strong> VMs.</li><li>Switch to your c7host VM, open a terminal and remain logged in as a regular user.</li><li>Issue the following command to connect to your <strong>centos1</strong> VM:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -X -C yourUserID@centos1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(where &#x27;yourUserID&#x27; is your user account name on centos1)</li><li>(The <strong>-X</strong> option enables the forwarding of X window information, and the <strong>-C</strong> option enables compression for better performance).</li></ul><ol start="4"><li>Once the connection is properly established, run the command <code>gedit</code></li><li>The <em>gedit</em> window will display on your <strong>c7host</strong> VM, but in reality, this application is running on your <strong>centos1</strong> VM!</li><li>Enter some text and save your editing session.</li><li>Exit the <strong>gedit</strong> application.</li><li>In which VM was the file saved? What does that tell you about the use of tunneling for this section?</li><li>Run the graphical program remotely by issuing only one Linux command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -X -C yourUserID@centos1 gedit </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(Note: ignore warning messages).</li></ul><ol start="10"><li>Exit the gedit application.</li><li>Experiment with running other GUI applications (in the /bin directory with applications starting with the letter &quot;x&quot; via <strong>ssh</strong> (for example: xev or xchat).</li></ol><p><strong>Answer INVESTIGATION 2 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-3-managing-firewalls-for-protection-and-troubleshooting">Investigation 3: Managing Firewalls For Protection and Troubleshooting<a class="hash-link" href="#investigation-3-managing-firewalls-for-protection-and-troubleshooting" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-firewall-iptables-concepts">Linux Firewall (iptables) Concepts<a class="hash-link" href="#linux-firewall-iptables-concepts" title="Direct link to heading">​</a></h3><p>Since Linux servers can be connected to the Internet, it is very important to run a <strong>firewall</strong> to control what packets might come into the computer system, what packets might go out of the computer system, and what packets might be forwarded to another computer. We are currently using the utility called <strong>iptables</strong> can be used to set the firewall rules on a Linux server.</p><p><img loading="lazy" alt="Chains" src="/OSL740/assets/images/Chains-85c8540e54b680d4e983ce44177a7a27.png" width="996" height="541" class="img_ev3q"></p><p>Basically, there is a list (<strong>chain</strong>) of policy rules that <strong>packets</strong> must pass-through in order to handle packets. If a packet matches a rule, then an action is taken (some examples include: <strong>ACCEPT</strong>, <strong>DROP</strong>, <strong>REJECT</strong>, or <strong>LOG</strong>). If the packet passes through the chain of rules without a match, then the packet is directed to the default policy chain (for example: <em>ACCEPT</em>, <em>REJECT</em>, or <em>DROP</em>).</p><p>You can create your own <strong>customized chains</strong> (which you will learn in the OPS335 course) but to keep thing simple, we only deal with 3 <strong>common predefined chains</strong>:</p><ul><li><strong>INPUT</strong>: Packets coming into current Linux server</li><li><strong>OUTPUT</strong>: Packets leaving current Linux server</li><li><strong>FORWARD</strong>: Packets being routed between Linux servers</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-listing-and-clearing-existing-iptables-rules">Part 1: Listing and Clearing Existing iptables Rules<a class="hash-link" href="#part-1-listing-and-clearing-existing-iptables-rules" title="Direct link to heading">​</a></h3><p>Let&#x27;s get some practice using the iptables command such as listing CHAIN rules, and clearing the CHAIN rules:</p><p><strong>Perform the following steps:</strong></p><ol><li>For the remainder of this section, use your <strong>c7host</strong> machine.</li><li>Issue the following command to list the existing iptables policy rules:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> iptables -L</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Were there already iptables policy rules that already existed by default?</li><li>Note that normal users are not permitted to view iptables settings. Try running the previous command without sudo. You must use sudo to use the iptables command.</li><li>Before we proceed, we need to understand various methods to list iptables rules:</li></ol><p><strong>Listing iptables Rules:</strong></p><table><thead><tr><th align="left">Command(s)</th><th align="left">Rules</th></tr></thead><tbody><tr><td align="left"><strong>iptables -L</strong></td><td align="left">List all iptables rules (eg. INPUT, OUTPUT. FORWARD, and any customized chains (if any)</td></tr><tr><td align="left"><strong>iptables -L -v</strong></td><td align="left">Verbosely List all iptables rules including information such as total size of packets affected by rules</td></tr><tr><td align="left"><strong>iptables -L CHAIN-NAME</strong></td><td align="left">List all iptables rules for that particular chain-name for less clutter (eg. INPUT or OUTPUT, etc)</td></tr></tbody></table><ol start="6"><li>Issue the following Linux command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -L INPUT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>What do you notice is different with this command compared to the previous iptables command?</li></ul><ol start="7"><li>Issue the iptables command separately to display the rules for the <strong>OUTPUT</strong> chain and for the <strong>FORWARD</strong> chain.</li><li>Issue the following command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -L -v</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>What do you notice about this command as opposed to the first iptables command you issued?</li><li>What sort of additional information does this command provide regarding affected packets?</li></ul><ol start="9"><li>Sometimes it may be useful to completely clear the rules for all or a particular chain. Note the options that can be used to clear (or flush) the iptables rules,</li></ol><p><strong>Clearing (Flushing) iptables Rules:</strong></p><table><thead><tr><th align="left">Command(s)</th><th align="left">Rules</th></tr></thead><tbody><tr><td align="left"><strong>iptables -F</strong></td><td align="left">Clears the rules for ALL of the chains</td></tr><tr><td align="left"><strong>iptables -F CHAIN-NAME</strong></td><td align="left">Clears the rules for only the specified CHAIN-NAME (eg. INPUT or OUTPUT)</td></tr></tbody></table><ol start="10"><li>Issue the following command to reset the iptables rules for the INPUT chain:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -F INPUT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="11"><li>Issue the <strong>iptables -L INPUT</strong> command to verify that the iptables rules for the INPUT chain have been cleared.</li><li>Now, issue the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -F</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>and then issue the command: </li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -L</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>What do you notice?</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-setting-a-default-policy-and-setting-policy-exceptions-iptables">Part 2: Setting a Default Policy and Setting Policy Exceptions (iptables)<a class="hash-link" href="#part-2-setting-a-default-policy-and-setting-policy-exceptions-iptables" title="Direct link to heading">​</a></h3><p>Usually when setting policy rules with iptables, a general &quot;overall&quot; policy is set (default policy chain). A good way to think about setting policies is to have a &quot;<strong>safety-net</strong>&quot; to take some sort of action to prevent un-handled packets from passing through the firewall by mistake. After the default policy is set-up, then specific exceptions to the default policy can be added to control specific network traffic.</p><p>An example would be to set a default policy for incoming network traffic (INPUT chain) to DROP everything, and then set an exception certain exceptions (like ssh connections). Note the following table below for policy setting examples.</p><p><strong>Policy Setting Examples:</strong></p><table><thead><tr><th align="left">Command(s)</th><th align="left">Result</th></tr></thead><tbody><tr><td align="left"><strong>iptables -P INPUT DROP</strong></td><td align="left">Drops all incoming packets regardless of protocol (eg. tcp, udp, icmp), port numbers (eg. 22, 80) or source or destination IP Addresses. Setting a default rule to DROP all incoming traffic would make it easier to specify a few exceptions.</td></tr><tr><td align="left"><strong>iptables -P INPUT ACCEPT</strong></td><td align="left">Accepts all incoming packets regardless of protocol (eg. tcp, udp, icmp), port numbers (eg. 22, 80) or source or destination IP Addresses. It would seem that setting a default rule to ACCEPT all incoming traffic would require A LOT of exceptions to help &quot;lock-down&quot; the server for protection! The better practice is to use DROP as the default action, and only ACCEPT the traffic you actually want.</td></tr></tbody></table><p><strong>Perform the following steps:</strong></p><ol><li>Make certain you are in your <strong>c7host</strong> machine.</li><li>Issue the following Linux command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -P INPUT DROP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Issue the <strong>iptables -L</strong> command. Can you see the policy to DROP all incoming connections?</li><li>Although you have set a default policy to DROP all incoming connections, there is a problem: now, you cannot browse the Internet. You can confirm that by opening a SEPARATE web-browser and perform a Net-search.</li></ol><ul><li><p>In order to fix that problem, you can make an exception to allow incoming web-based traffic (via port 80). Those iptables commands to create exceptions are more complex since you need to determine:</p><ul><li><strong>Where each rules appears in the chain</strong>? (order can be important)</li><li><strong>Which protocol(s)</strong> are affected (eg. tcp, udp, icmp)</li><li><strong>What source or destination IP Addresses</strong> are affected?</li><li><strong>What port numbers</strong> are affected?</li><li><strong>What action to take</strong> if all of the above conditions are met? (eg. ACCEPT, REJECT, DROP, or LOG)</li></ul></li></ul><p><strong>iptables Command Structure (for setting exceptions):</strong></p><p><strong>(NOTE: If element in column is not specified in the iptables command, then rule relates to ALL elements)</strong></p><table><thead><tr><th align="left">Place Rule in Chain</th><th align="left">Chain Name</th><th align="left">Specify Protocol</th><th align="left">Source/Destination IPADDR</th><th align="left">Port Number</th><th align="left">Action -&gt;</th><th align="left">Target</th></tr></thead><tbody><tr><td align="left"><strong>-A</strong> (add / Append to bottom of chain) <strong>-I</strong> (insert at top of chain) <strong>-I CHAIN-NAME 5</strong> (insert before line 5)</td><td align="left"><strong>INPUT</strong>, <strong>OUTPUT</strong>, <strong>FORWARD</strong>, <strong>CHAIN-NAME</strong></td><td align="left"><strong>-p tcp</strong> (tcp packets), <strong>-p udp</strong> (datagram packets), <strong>-p tcp,udp,icmp</strong> (combined), (refer to <strong>/etc/protocols</strong> )</td><td align="left"><strong>-s IPADDR</strong> (originating IPADDR), <strong>-d IPADDR</strong> (destination IPADDR)</td><td align="left"><strong>--sport 22</strong> (originating port 22 - SSH), <strong>--dport 80</strong> (destined port 80 - http), (refer to <strong>/etc/services</strong>)</td><td align="left"><strong>-j</strong></td><td align="left"><strong>ACCEPT</strong>, <strong>REJECT</strong>, <strong>DROP</strong>, <strong>LOG</strong></td></tr></tbody></table><ol start="5"><li>Issue the following Linux command to ensure the loopback interface is not affected by these rules. The computer needs to be able to communicate with itself with any state and protocol:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -i lo -p all -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Issue the following Linux command to ensure the system can get responses to traffic it sends out:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>Note that both of the previous rules actually already existed in the default iptables rules before we deleted them.</li><li>Use your other web-browser to confirm that you can now browse the Internet. If you cannot, contact your lab assistant or professor for help.</li><li>Determine the <strong>external facing address</strong> of your c7host machine. (<strong>Tip</strong>: in a web-browser, enter the term: &quot;<strong>ip address</strong>&quot;. The external facing IP Address should start with &quot;<strong>10.</strong>&quot;).</li><li>Using your Windows machine running VMware (or another machine in your network if you did a bare-metal installation for c7hsost) try to ping that external facing address. Were you successful?</li><li>Issue the following iptables command to allow an exception for pings from the machine you are using to contact your c7host:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -p icmp -s </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">other machine&#x27;s external facing address</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="12"><li>Repeat pinging your c7host&#x27;s external facing IP Address. What happened? Why?</li><li>Try to SSH into YOUR c7host. Were you Successful?</li><li>Issue the following Linux command to ADD an exception to the INPUT chain to allow incoming ssh traffic (ie. port 22):</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A INPUT -p tcp --dport </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="15"><li>Issue an iptables command to confirm that there is an exception rule to handle incoming tcp packets using port 22.</li><li>Try to SSH into your c7host (at least to get a password prompt). Were you Successful? If so, why?</li><li>Note that the rule we entered would allow <strong>anyone</strong> who can reach your c7host to try to log in with ssh. This is <strong>not</strong> a good idea. What would you have to change about that rule to only allow the one machine you are connecting from?</li><li>Shutdown all VMs and restart your c7host Linux machine.</li><li>List the iptables rules for the INPUT chain. What happened to your iptables rules for the INPUT chain?</li><li>Proceed to the next part to learn how to learn how to make your iptables rules persistent.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-making-iptables-policies-persistent">Part 3: Making iptables Policies Persistent<a class="hash-link" href="#part-3-making-iptables-policies-persistent" title="Direct link to heading">​</a></h3><p>Any changes to your iptables policy rules will be lost when you restart your Linux server, unless you make your iptables rules persistent. Failure to perform the following steps after setting up your firewall rules can cause confusion and wasted time.</p><p><strong>Don&#x27;t save copies of rules that libvirtd will auto-add every boot.</strong></p><p>The libvirtd service running on your c7host automatically adds some rules to iptables to allow the machines in your virtual network comunicate with each other and the outside world. We don&#x27;t want to save these, or you will end up with two (or more) copies of them in your firewall. This won&#x27;t actually break anything, but it does clutter up your iptables and make them harder to read. Before you continue with this investigaion, restart your iptables. This will leave you with just the rules that exist in its saved configuration, and not the ones added by libvirtd.</p><p><strong>Perform the following steps:</strong></p><ol><li>Make a backup of the file <strong>/etc/sysconfig/iptables</strong> by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> /etc/sysconfig/iptables /etc/sysconfig/iptables.bk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Make sure the default policy of your INPUT and FORWARD chains are both set to DROP.</li><li>Delete the rule in the INPUT chain that allows SSH traffic from <strong>anyone</strong>, and replace it with one that only allows ssh traffic sent by your other machine (that is, your windows host, or other machine in your network).</li><li>Note that this now means your VMs won&#x27;t be able to ssh to your c7host, so add a rule that allows the entire network your VMs are on (192.168.245.0/24) to ssh to your c7host.</li><li>Delete the rule in the INPUT chain that allows ICMP traffic from <strong>anyone</strong>, and replace it with one that only allows ssh traffic sent by your other machine.</li><li>Delete the rule in your <strong>INPUT</strong>&#x27; <strong>and</strong> <em>FORWARD</em> <strong>chains that</strong> <em>REJECTs</em> <strong>any traffic you haven&#x27;t</strong> _ACCEPT_ed. You are better protected by the default <strong>DROP</strong> policy you set.</li><li>To make the iptables rules <strong>persistent</strong> (i.e. keeps rules when system restarts), you issue the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> -c </span><span class="token string" style="color:#e3116c">&#x27;iptables-save &gt; /etc/sysconfig/iptables&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>(NOTE: redirections happen before the actual command execution and don&#x27;t run with the elevated sudo privileges, therefore we need to use &#x27;sh -c&#x27;)</li></ul><ol start="8"><li>Verify that the file <strong>/etc/sysconfig/iptables</strong> exists.</li><li>Restart your iptables service and test your configuration.</li><li>Restart the libvirtd service, and note the rules it adds to your iptables. It will do this automatically every time it starts.</li></ol><p><strong>Answer INVESTIGATION 3 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-7-sign-off-show-instructor">Lab 7 Sign-Off (Show Instructor)<a class="hash-link" href="#lab-7-sign-off-show-instructor" title="Direct link to heading">​</a></h2><p>Follow the submission instructions for lab 7 on Blackboard.</p><p><strong>Time for a new backup!</strong></p><p>If you have successfully completed this lab, make a new backup of your virtual machines as well as your host machine.</p><p><strong>Perform the Following Steps:</strong></p><ol><li>Make certain ALL of your VMs are running.</li><li>Switch to your <strong>c7host</strong> VM and change to your user&#x27;s <strong>bin</strong> directory.</li><li>Issue the Linux command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://osl740.github.io/labs/lab7-check.bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Give the <strong>lab7-check.bash</strong> file execute permissions (for the file owner).</li><li>Run the shell script and if there are any warnings, make fixes and re-run shell script until you receive &quot;congratulations&quot; message.</li><li>Arrange proof of the following on the screen:</li></ol><ul class="contains-task-list containsTaskList_mC6p"><li class="task-list-item"><p><input type="checkbox" checked="" disabled=""> <!-- -->centos2 VM:</p><ul><li>have logged into centos3 VM using <strong>public key authentication</strong> (with a pass-phrase)</li></ul></li><li class="task-list-item"><p><input type="checkbox" checked="" disabled=""> <!-- -->c7host Machine:</p><ul><li>have tunneled Xwindows application from <strong>centos1</strong> via ssh</li><li>Run the <strong>lab7-check.bash</strong> script in front of your instructor (must have all  <code>OK</code>  messages)</li></ul></li><li class="task-list-item"><p><input type="checkbox" checked="" disabled=""> <strong>Lab7</strong> log-book filled out.</p></li></ul><ol start="7"><li>Upload a screenshot of proof from the previous step, along with your logbook, and the file generated by <strong>lab7-check.bash</strong>.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="practice-for-quizzes-tests-midterm-and-final-exam">Practice For Quizzes, Tests, Midterm, and Final Exam<a class="hash-link" href="#practice-for-quizzes-tests-midterm-and-final-exam" title="Direct link to heading">​</a></h2><ol><li>What port does sshd use by defaults?</li><li>What file is used to configure sshd?</li><li>What kind of files are stored in the &quot;~/.ssh/&quot; directory?</li><li>How do you determine whether the sshd service is running on your system or not?</li><li>What is the purpose of the ~/.ssh/known_hosts file?</li><li>What is the purpose of the ~/.ssh/authorized_keys file?</li><li>Which system log file records each use of the sudo command?</li><li>How do you stop the sshd service?</li><li>How do you tunnel XWindows applications?</li><li>What port is the default ssh port?</li><li>What port(s) is/are used by httpd service?</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/OSL740/tree/main/docs/A-Labs/lab7.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/OSL740/A-Labs/lab6"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 6</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/OSL740/A-Labs/lab8"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 8</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lab-preparation" class="table-of-contents__link toc-highlight">Lab Preparation</a><ul><li><a href="#purpose-and-objectives-of-lab-7" class="table-of-contents__link toc-highlight">Purpose and Objectives of Lab 7</a></li><li><a href="#minimum-required-materials" class="table-of-contents__link toc-highlight">Minimum Required Materials</a></li><li><a href="#linux-command-reference" class="table-of-contents__link toc-highlight">Linux Command Reference</a></li></ul></li><li><a href="#investigation-1-installing-and-maintaining-an-ssh-server" class="table-of-contents__link toc-highlight">Investigation 1: Installing And Maintaining An SSH Server</a><ul><li><a href="#part-1-confirming-sshd-service-is-running-on-vms" class="table-of-contents__link toc-highlight">Part 1: Confirming sshd service is Running on VMs.</a></li><li><a href="#part-2-ssh-server-security-configuration" class="table-of-contents__link toc-highlight">Part 2: SSH Server Security Configuration</a></li></ul></li><li><a href="#investigation-2-additional-methods-to-secure-your-ssh-server" class="table-of-contents__link toc-highlight">Investigation 2: Additional Methods To Secure Your SSH Server</a><ul><li><a href="#part-1-generating-private-and-public-keys-public-key-infrastructure" class="table-of-contents__link toc-highlight">Part 1: Generating Private and Public Keys (Public Key Infrastructure)</a></li><li><a href="#part-2-securely-running-graphical-applications-between-linux-servers" class="table-of-contents__link toc-highlight">Part 2: Securely Running Graphical Applications Between Linux Servers</a></li></ul></li><li><a href="#investigation-3-managing-firewalls-for-protection-and-troubleshooting" class="table-of-contents__link toc-highlight">Investigation 3: Managing Firewalls For Protection and Troubleshooting</a><ul><li><a href="#linux-firewall-iptables-concepts" class="table-of-contents__link toc-highlight">Linux Firewall (iptables) Concepts</a></li><li><a href="#part-1-listing-and-clearing-existing-iptables-rules" class="table-of-contents__link toc-highlight">Part 1: Listing and Clearing Existing iptables Rules</a></li><li><a href="#part-2-setting-a-default-policy-and-setting-policy-exceptions-iptables" class="table-of-contents__link toc-highlight">Part 2: Setting a Default Policy and Setting Policy Exceptions (iptables)</a></li><li><a href="#part-3-making-iptables-policies-persistent" class="table-of-contents__link toc-highlight">Part 3: Making iptables Policies Persistent</a></li></ul></li><li><a href="#lab-7-sign-off-show-instructor" class="table-of-contents__link toc-highlight">Lab 7 Sign-Off (Show Instructor)</a></li><li><a href="#practice-for-quizzes-tests-midterm-and-final-exam" class="table-of-contents__link toc-highlight">Practice For Quizzes, Tests, Midterm, and Final Exam</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">OSL740 - Administration of Open Source Systems</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/OSL740/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seneca College.</div></div></div></footer></div>
<script src="/OSL740/assets/js/runtime~main.e8ac8b46.js"></script>
<script src="/OSL740/assets/js/main.90f2afc0.js"></script>
</body>
</html>