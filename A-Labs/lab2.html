<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-A-Labs/lab2">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/OSL740/img/pwa/icon-512x512.png">
<link rel="manifest" href="/OSL740/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/OSL740/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/OSL740/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/OSL740/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Lab 2 | OSL740 - Administration of Open Source Systems</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 2 | OSL740 - Administration of Open Source Systems"><meta data-rh="true" name="description" content="Lab 2 for Students to Complete and Submit"><meta data-rh="true" property="og:description" content="Lab 2 for Students to Complete and Submit"><link data-rh="true" rel="icon" href="/OSL740/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab2"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab2" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//OSL740/A-Labs/lab2" hreflang="x-default"><link rel="stylesheet" href="/OSL740/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/OSL740/assets/js/runtime~main.37dfe5e2.js" as="script">
<link rel="preload" href="/OSL740/assets/js/main.90f2afc0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/OSL740/"><div class="navbar__logo"><img src="/OSL740/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/OSL740/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">OSL740 - Administration of Open Source Systems</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OSL740/">Welcome to OSL740</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/OSL740/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/OSL740/A-Labs/lab1">Labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab1">Lab 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/OSL740/A-Labs/lab2">Lab 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab3">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab4">Lab 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab5">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab6">Lab 6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab7">Lab 7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/OSL740/A-Labs/lab8">Lab 8</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OSL740/B-Assignments/assignment1">Assignments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/OSL740/C-ExtraResources/tips">Extra Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/OSL740/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Labs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 2: Creating and Using Virtual Machines</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-preparation">LAB PREPARATION<a class="hash-link" href="#lab-preparation" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="purpose--objectives-of-lab-2">Purpose / Objectives of Lab 2<a class="hash-link" href="#purpose--objectives-of-lab-2" title="Direct link to heading">​</a></h3><p>In this lab, you will create 3 remaining virtual machines using another virtualization program called <strong>KVM</strong> that will run in your c7host VM. These VMs will be used throughout the remainder of this course to learn how to administer them (installing software, managing services, networking, etc).</p><p>While you are performing this lab, it is recommended to generally note the major differences in the different installation methods, and which method you prefer to use if you were a Linux system administrator in charge of installing many Linux distributions for an organization.</p><p><strong>Main Objectives</strong></p><ul><li><p>Installing additional Virtualization Software on your <strong>c7host</strong> machine (<strong>KVM</strong>)</p></li><li><p><strong>Create 3 separate VMs (virtual machines) using different installation methods:</strong></p><ul><li><strong>centos1</strong>: Network CentOS Installation (<strong>Graphical</strong>)</li><li><strong>centos2</strong>: Network CentOS Installation (minimal install - <strong>CLI only</strong>)</li><li><strong>centos3</strong>: Network CentOS Installation with Kickstart configuration file (<strong>CLI only</strong>)</li></ul></li><li><p>Manipulate virtual machines by CLI (<strong>virsh</strong>)</p></li><li><p>Properly <strong>backup VM images</strong> and backup <strong>VM configuration files</strong></p></li><li><p>Create and run <strong>Bash Shell scripts</strong> to automatically create a post-install report for an installed VM.</p></li></ul><p><img loading="lazy" alt="VMWare 1a" src="/OSL740/assets/images/Vmware-1a-48b7c30cf594bca7d12e55f986a3ea5e.png" width="790" height="710" class="img_ev3q"></p><p>At the end of lab2, your VMware Workstation application will contain <strong>4 virtual machines</strong> (<strong>c7host</strong> in your <strong>VMware Workstation</strong> application, and <strong>centos1, centos2, centos3 VMs</strong> in your <strong>KVM</strong> application). You will now have the option to run one virtual machine at a time, or run all machines simultaneously to learn about networking (covered in later labs)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minimum-required-materials">Minimum Required Materials<a class="hash-link" href="#minimum-required-materials" title="Direct link to heading">​</a></h3><ol><li><strong>Solid State Drive</strong></li><li><strong>USB key</strong> (for backups)</li><li><strong>Lab2 Log Book</strong></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-command-reference">Linux Command Reference<a class="hash-link" href="#linux-command-reference" title="Direct link to heading">​</a></h3><p><strong>Virtualization:</strong></p><ul><li><a href="http://linux.die.net/man/1/virt-manager" target="_blank" rel="noopener noreferrer">virt-manager</a></li><li><a href="http://linux.die.net/man/1/virsh" target="_blank" rel="noopener noreferrer">virsh</a></li></ul><p><strong>Installation Guides:</strong></p><ul><li><a href="http://wiki.centos.org/HowTos/KVM" target="_blank" rel="noopener noreferrer">Installing &amp; Using KVM on CentOS</a></li><li><a href="http://www.dedoimedo.com/computers/kvm-intro.html" target="_blank" rel="noopener noreferrer">Using KVM (tutorial)</a></li><li><a href="https://libvirt.org/sources/virshcmdref/html-single/" target="_blank" rel="noopener noreferrer">virsh command reference</a></li></ul><p><strong>Miscellaneous</strong></p><table><thead><tr><th><a href="http://linuxcommand.org/lc3_man_pages/gzip1.html" target="_blank" rel="noopener noreferrer">gzip , gunzip</a></th><th><a href="http://man7.org/linux/man-pages/man8/ip.8.html" target="_blank" rel="noopener noreferrer">ip</a></th><th><a href="http://man7.org/linux/man-pages/man1/grep.1.html" target="_blank" rel="noopener noreferrer">grep</a></th><th><a href="http://man7.org/linux/man-pages/man1/wc.1.html" target="_blank" rel="noopener noreferrer">wc</a></th><th><a href="http://man7.org/linux/man-pages/man1/pwd.1.html" target="_blank" rel="noopener noreferrer">pwd</a></th><th><a href="http://man7.org/linux/man-pages/man1/ls.1.html" target="_blank" rel="noopener noreferrer">ls</a></th><th><a href="http://man7.org/linux/man-pages/man1/more.1.html" target="_blank" rel="noopener noreferrer">more</a></th><th><a href="http://man7.org/linux/man-pages/man1/file.1.html" target="_blank" rel="noopener noreferrer">file</a></th><th><a href="http://man7.org/linux/man-pages/man1/wget.1.html" target="_blank" rel="noopener noreferrer">wget</a></th><th><a href="http://man7.org/linux/man-pages/man1/chmod.1.html" target="_blank" rel="noopener noreferrer">chmod</a></th><th><a href="http://ss64.com/vi.html" target="_blank" rel="noopener noreferrer">vi</a></th></tr></thead></table><p><strong>Matrix Online Tutorials:</strong></p><ul><li>Shell Scripting - Part 2 (Logic &amp; Math Expressions): <strong>/home/ops235/scripting-2</strong></li><li>Shell Scripting - Part 3 (Loops) <strong>/home/ops235/scripting-3</strong></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-1-setup-for-nested-virtual-machines">Investigation 1: Setup For Nested Virtual Machines<a class="hash-link" href="#investigation-1-setup-for-nested-virtual-machines" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-install-kvm-virtualization-application">Part 1: Install KVM Virtualization Application<a class="hash-link" href="#part-1-install-kvm-virtualization-application" title="Direct link to heading">​</a></h3><p>We will now install the KVM package in order to create our remaining &quot;nested&quot; VMs. We will also be starting several services (including iptables) and disabling the firewalld service. We will learn more about managing firewalls using iptables in lab6.</p><p><strong>Perform the following steps:</strong></p><ol><li>Log into your c7host machine.</li><li>perform a software update on your c7host VM by issuing the following command: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Yum Update Hangs</strong></p><p>If you experience yum update &quot;hanging&quot; around item 689 of over 1200 packages, issue the following commands (<strong>in a new terminal!</strong>):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pkill</span><span class="token plain"> systemctl</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum clean all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>NOTE</strong>: Do NOT press <strong>&lt;ctrl<!-- -->&gt;<!-- -->c</strong> since it may cause your machine to cause a kernel panic when you restart your machine.</p><ol start="3"><li>Using elevated privileges, install the virtualization software by issuing the command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> qemu-kvm qemu-img virt-manager libvirt libvirt-python </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libvirt-client virt-install virt-viewer bridge-utils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>About KVM</strong></p><p>There are actually several key programs installed for virtualization using KVM:</p><ul><li><strong>kvm/qemu</strong> - the hypervisor and other hardware emulation systems.</li><li>A system service named <strong>libvirtd</strong> that manages the VMs.</li><li>A graphical tool for managing virtual machines (<strong>virt-manager</strong>) and the <strong>virsh</strong> command-line tool.</li></ul><ol start="4"><li><strong>Restart your c7host virtual machine</strong>. If you fail to do this, you may experience virtualization network problems.</li><li>Start the virtualization service: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start libvirtd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>NOTE</strong>: The most recent variants of CentOS and Fedora are using a service called <strong>firewalld</strong> that replaces <strong>iptables</strong>, however the <em>iptables</em> service is still in relatively common usage and knowing how to use it also works with firewalld. In this course we will concentrate on <em>iptables</em>.</li></ul><ol start="6"><li>To disable and remove firewalld, issue the following commands:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl disable firewalld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl stop firewalld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum remove firewalld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="7"><li>To install and enable the IPTables services, issue the following commands:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> iptables-services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> iptables</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start iptables</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Run virt-manager as a regular user, not as root</strong></p><p>Otherwise all your virtual machines will be owned by root and you won&#x27;t be able to use them as a regular user.</p><ol start="8"><li>Start the graphical tool by selecting the menu options <strong>Applications&gt;System Tools&gt;Virtual Machine Manager</strong> or by typing the command <code>virt-manager</code> (without sudo!)</li><li>You will be learning in the next investigation to perform several different types of CentOS Linux installs.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-configure-vmware-workstation-for-nested-vms">Part 2: Configure VMware Workstation for Nested VMs<a class="hash-link" href="#part-2-configure-vmware-workstation-for-nested-vms" title="Direct link to heading">​</a></h3><p>Although we are using VMware Workstation to run our c7host VM, we will now install and configure another virtualization package called KVM in order to install the remaining VMs for this course. Since we are &quot;nesting&quot; VMs (i.e. running a VM inside another VM) we need to configure our c7host&#x27;s Linux boot-up parameters in order to allow these VMs to run efficiently.</p><p><strong>Perform the following steps:</strong></p><ol><li><p>In a terminal use elavated privileges to edit the file called: <strong>/boot/efi/EFI/centos/grub.cfg</strong></p><ul><li><strong>If this file doesn&#x27;t exist, double-check your UEFI settings in VMWare Workstation for c7host. If BIOS is selected, you MUST redo Lab 1.</strong></li></ul></li><li><p>Search for the <strong>first occurrence</strong> of the Linux Kernel boot command. Do not make the following changes on more than one entry!</p></li><li><p>Insert the boot option: <strong>kvm-intel.nested=1</strong> (for AMD processors <strong>kvm-amd.nested=1</strong>) at the end of the Linux kernel boot options.</p></li></ol><p><strong>About the reference settings shown below</strong></p><ul><li>Only <strong>ONE</strong> of these settings might be applicable.</li><li>Enter <strong>JUST</strong> the text highlighted in <strong>BOLD</strong> as your kernel version, root, and LVM settings might vary slightly.</li></ul><p>linuxefi /vmlinuz-3.10.0-1062.1.2.el7.x86_64 root=/dev/mapper/centos_c7host-root ro crashkernel=auto rd.lvm.lv=centos_c7host/root rd.lvm.lv=centos_c7host/swap rhgb quiet LANG=en_CA.UTF-8 <strong>kvm-intel.nested=1</strong> initrdefi /initramfs-3.10.0-1062.1.2.el7.x86_64.img</p><p>OR</p><p>linuxefi /boot/vmlinuz-3.10.0-1062.el7.x86_64 root=/dev/mapper/centos_c7host-root ro crashkernel=auto rd.lvm.lv=centos_c7host/root rd.lvm.lv=centos_c7host/swap rhgb quiet LANG=en_CA.UTF-8 <strong>kvm-intel.nested=1</strong> initrdefi /boot/initramfs-3.10.0-1062.el7.x86_64.img</p><ol start="4"><li>Save your editing changes, close the virtual machine application, and <strong>reboot</strong> your c7host VM.</li><li>If you configured your c7host VM for nested VMs, then you should get the output <code>Y</code> when you issue the following command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /sys/module/kvm_intel/parameters/nested</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>For <strong>AMD</strong> processors, check the /sys/module/<strong>kvm_amd</strong>/parameters/nested file. You should get the output <code>1</code></li><li>And if kvm_intel directory doesn&#x27;t exist, double-check your <strong>Processors =&gt; Virtualization Engine (Intel VT-x/EPT...)</strong> settings in VMWare Workstation.</li></ul><p><strong>Answer the INVESTIGATION 1 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-2-install-nested-virtual-machines-kvm">Investigation 2: Install Nested Virtual Machines (KVM)<a class="hash-link" href="#investigation-2-install-nested-virtual-machines-kvm" title="Direct link to heading">​</a></h2><p><strong>Keep the root password the same for Host and VMs</strong></p><p>In order to simplify running the lab checking scripts in future labs, using the same root password for ALL machines (c7host and virtual machines). Also use the same username and passwords for all of your machines (c7host and virtual machines).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-installing-vm-from-a-network-graphical">Part 1: Installing VM from a Network (Graphical)<a class="hash-link" href="#part-1-installing-vm-from-a-network-graphical" title="Direct link to heading">​</a></h3><p><strong>VM Details:</strong></p><ul><li><p><strong>VM Name (and hostname)</strong>: centos1</p></li><li><p><strong>Boot media</strong>: Network installation</p></li><li><p><strong>CentOS Full Network Install URL</strong>:</p><ul><li>Seneca Lab: <a href="http://mirror.senecacollege.ca/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">http://mirror.senecacollege.ca/centos/7/os/x86_64/</a> <strong>(NOTE: requires VPN)</strong></li><li>Home: <a href="http://mirror.netflash.net/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">http://mirror.netflash.net/centos/7/os/x86_64/</a></li></ul></li><li><p><strong>VM Image Pathname</strong>: /var/lib/libvirt/images/centos1.qcow2</p></li><li><p><strong>Memory</strong>: 2048MB</p></li><li><p><strong>Disk space</strong>: 15GB</p></li><li><p><strong>CPUs</strong>: 2</p></li></ul><p><strong>Perform the following steps:</strong></p><ol><li>Launch the <em>KVM virtual machine manager</em> by clicking <strong>Applications -&gt; System Tools -&gt; Virtual Machine Manager</strong>.</li><li>When prompted, enter your password.</li><li>Click the <strong>create a new VM icon</strong> located near the top left-corner of the application window.</li><li>Select the <strong>Network Install</strong> option and click <strong>Forward</strong>.</li><li>Enter (copy and paste) the URL located at the top of this section (depending whether you are at Seneca College or not) and click <strong>Forward</strong>.</li><li>Set RAM size to 2048 MB and CPUs to 2, then click <strong>Forward</strong>.</li><li>Set Hard Disk size to 15GB and click <strong>Forward</strong>.</li><li>Enter the name: <strong>centos1</strong>, AND then select the option: <strong>Customize configuration before install</strong>, and click <strong>Finish</strong>.</li><li>Another dialog will appear. Click <strong>CPUs</strong> (or &quot;processors&quot;) and on right-side under Configuration select <strong>Copy Host CPU Configuration</strong>, click <strong>Apply</strong>, and then click <strong>Begin Installation</strong> at the top left-hand side.</li><li>During the install, select <strong>Gnome Desktop</strong> (software selection). For partitioning, select <strong>I will configure partitions</strong> settings, click done, then select <strong>Click here to create them automatically</strong>. Set the / partition for <strong>ext4</strong> file-system type, and click <strong>Done</strong>.</li><li>Set the correct <strong>Date and Time Zone</strong>, and then click on <strong>Network and Hostname</strong>. The network should be turned <strong>ON</strong>. For hostname, enter: <strong>centos1</strong> and then click <strong>Done</strong>.</li></ol><p><img loading="lazy" alt="KVM Warning" src="/OSL740/assets/images/Kvm-warning-eb5f02bff6fee0781dd21ae469defe5a.jpg" width="570" height="608" class="img_ev3q"></p><p>You may see this warning when creating your first VM inside CentOS. Select <strong><em>Don&#x27;t ask me about these directories again</em></strong> and click <strong><em>Yes</em></strong>.</p><ol start="12"><li>Make sure that when you create your regular user account you check the box to make them an administrator.</li><li>Complete the installation. Login to your regular user account, and perform a <strong>sudo yum update</strong> for the centos1 VM (reboot if required). Make certain to adjust your screen-saver settings if desired.</li></ol><p><strong>Use same root password / regular username / regular user passwords for c7host and ALL VMs</strong></p><p>To simplify the lab checking process make certain that you use the identical root password, regular username, and regular username password for VMs that you create in this labs as you did for c7host machine in lab1.</p><ol start="14"><li>Repeat the steps as you did in the previous investigation <a href="#part-1-install-kvm-virtualization-application">(Investigation1 Part 1)</a> to <strong>stop, disable and remove firewalld, install iptables-services, start and enable iptables</strong> for this newly-created VM.</li><li>Repeat the steps as you did with c7host post-install to <strong>turn off (permissive) SELinux</strong> and perform a <strong>yum update</strong>.</li><li>Issue the following command to obtain the IPADDR for your centos1 VM to record in your lab2 logbook: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> address show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="17"><li>Record the time taken to install, and compare this to the time taken by the previous installations in your lab2 logbook.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-installing-from-a-network-minimal-install---cli">Part 2: Installing from a Network (Minimal install - CLI)<a class="hash-link" href="#part-2-installing-from-a-network-minimal-install---cli" title="Direct link to heading">​</a></h3><p><strong>VM Details:</strong></p><ul><li><p><strong>VM Name (and hostname)</strong>: centos2</p></li><li><p><strong>Boot media</strong>: Network installation</p></li><li><p><strong>CentOS Full Network Install URL</strong>:</p><ul><li>Seneca Lab: <a href="http://mirror.senecacollege.ca/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">http://mirror.senecacollege.ca/centos/7/os/x86_64/</a> <strong>(NOTE: requires VPN)</strong></li><li>Home: <a href="http://mirror.netflash.net/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">http://mirror.netflash.net/centos/7/os/x86_64/</a></li></ul></li><li><p><strong>VM Image Pathname</strong>: /var/lib/libvirt/images/centos2.qcow2</p></li><li><p><strong>Memory</strong>: 2048MB</p></li><li><p><strong>Disk space</strong>: 20GB</p></li><li><p><strong>CPUs</strong>: 1</p></li></ul><p><strong>Perform the following steps:</strong></p><ol><li><p>Create the VM (called <strong>centos2</strong>) as you did with the <em>centos1</em> machine.</p></li><li><p>Make certain to enter the name: <strong>centos2</strong>, AND then select the option: <strong>Customize configuration before install</strong>, and select <strong>Copy Host CPU Configuration</strong>, click <strong>Apply</strong>, and then click <strong>Begin Installation</strong>.</p></li><li><p>When selecting the install options for centos2, do the same operation that you did in centos1 (but with <strong>Minimal Install</strong> software selection instead), but after <strong>automatically creating the partitions</strong>, reduce the size of the root logical volume to <strong>8 GiB</strong> and add a logical volume with a size of <strong>2 GiB</strong> (mount point: <strong>/home</strong>, name: <strong>home</strong>, and make certain root and /home logical volumes have <strong>ext4</strong> file system).</p></li><li><p>Complete the installation. Login to your regular user account.</p></li><li><p>Repeat the steps as you did in the previous investigation <a href="#part-1-install-kvm-virtualization-application">(Investigation1 Part 1)</a> to <strong>stop and disable firewalld, install iptables-services, start and enable iptables</strong> for this newly-created VM.</p></li><li><p>Repeat the steps as you did with c7host post-install to <strong>turn off (permissive) SELinux</strong> (using the command &#x27;vi&#x27; instead of &#x27;vim&#x27;) and perform a <strong>yum update</strong>.</p></li><li><p>Issue the following command to obtain and record your centos2 IPADDR in your lab2 logbook: </p></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> address show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="8"><li>Record the time taken to install, and compare this to the time taken by the previous installations in your lab2 logbook.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-installing-from-a-network-using-a-kickstart-file">Part 3: Installing from a Network using a Kickstart File<a class="hash-link" href="#part-3-installing-from-a-network-using-a-kickstart-file" title="Direct link to heading">​</a></h3><p><strong>Using a Kickstart file with a local install</strong></p><p>Under most circumstances, a network install would be drawing the installation data from a server in the local network, allowing it to transmit data at higher speeds than we can achieve over the internet. If your download speed is slow enough that network installs are failing, it is acceptable to install these VMs from local media. However, you will still need to provide a kickstart file to Centos3.</p><p>To do so, start the install process as normal for an installation from an iso file, but when presented with the menu giving you the option to &#x27;Install CentOS 7&#x27; or &#x27;Test this media &amp; install CentOS 7&#x27;, highlight &#x27;Install CentOS7&#x27; and press <code>&lt;tab&gt;</code>. This will open a prompt at the bottom of the window for you to enter grub configuration options. Type <code>inst.ks=https://matrix.senecacollege.ca/~ahad.mammadov/OSL740/centos3-kickstart-local.cfg</code> and hit <code>&lt;enter&gt;</code>.</p><p><strong>VM Details:</strong></p><ul><li><p><strong>VM Name (and hostname)</strong>: centos3</p></li><li><p><strong>Boot media</strong>: Network installation</p></li><li><p><strong>CentOS 7 Full Install Network URL:</strong></p><ul><li>Seneca Lab: <a href="https://mirror.senecacollege.ca/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">https://mirror.senecacollege.ca/centos/7/os/x86_64/</a></li><li>Home: <a href="http://mirror.netflash.net/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">http://mirror.netflash.net/centos/7/os/x86_64/</a></li></ul></li><li><p><strong>Kickstart File URL (Kernel options):</strong></p><ul><li>Home: <code>ks=https://matrix.senecacollege.ca/~ahad.mammadov/OSL740/centos3-kickstart.cfg</code></li><li><strong>(NOTE: Ensure your Student VPN is connected!)</strong></li></ul></li><li><p><strong>VM Image Pathname</strong>: /var/lib/libvirt/images/centos3.qcow2</p></li><li><p><strong>Memory</strong>: 2048MB (<strong>IMPORTANT</strong> Do not use less than 2048MB during installation.)</p></li><li><p><strong>Disk space</strong>: 15GB</p></li><li><p><strong>CPUs</strong>: 2</p></li></ul><p><strong>Include ks= in the URL options field!</strong></p><p>When using a kickstart file, make sure you include the <strong><em>ks=</em></strong> portion of the link. If done correctly, you should not be able to select partitions or any other settings.</p><p><strong>Perform the following steps:</strong></p><ol><li><p>Create the VM (called <strong>centos3</strong>)</p></li><li><p>During the install, copy the network URL, then click the <strong>URL options</strong> to expand the <strong>kernel options</strong> input textbox. Type the following in the kernel options textbox:</p><ul><li><code>ks=https://matrix.senecacollege.ca/~ahad.mammadov/OSL740/centos3-kickstart.cfg</code></li></ul></li><li><p>Then click the <strong>forward</strong> button to proceed. Make certain to select the correct Memory Size and Disk Space size shown in the VM Details above</p></li><li><p>Make certain to enter the name: <strong>centos3</strong>, AND then select the option: <strong>Customize configuration before install</strong>, and select <strong>Copy Host CPU Configuration</strong>, click <strong>Apply</strong>, and then click <strong>Begin Installation</strong>.</p></li><li><p>Observe the installation. How is it different from booting from a downloaded image?</p></li><li><p>Record the time taken to install, and compare this to the time taken by the previous installations.</p><ul><li>If during the installation, you see the message at the bottom <strong>Pane is Dead</strong>, click the <strong>Virtual Machine</strong> menu at the top, select <strong>Shut Down -<!-- -->&gt;<!-- --> Force Off, right-click</strong> on <strong>centos3</strong> in the <em>virtual manager</em> window and select <strong>Delete</strong>. Redo the VM setup for a new instance of the <em>centos3</em> VM.</li></ul></li><li><p>What happens when the installation is finished?</p></li><li><p><strong>In a web browser</strong>, click the kickstart (KS) link above. This link is a text file. Read through it to find the following information (pay attention to lines starting with #) and record it in your Lab Logbook:</p><ul><li><strong>Regular-user account name</strong></li><li><strong>Regular-user account password</strong></li><li><strong>Root Password</strong></li></ul></li><li><p>Boot the virtual machine and log in (use the user ID and password information from the previous step to gain access to this VM).</p></li><li><p>Compare the experience to the first time you booted the other virtual machines.</p></li><li><p>Repeat the steps as you did in the previous investigation <a href="#part-1-install-kvm-virtualization-application">(Investigation1 Part 1)</a> to <strong>stop and disable firewalld, install iptables-services, start and enable iptables</strong> for this newly-created VM.</p></li><li><p>Repeat the steps as you did with c7host post-install to <strong>turn off SELinux</strong> and perform a <strong>yum update</strong>.</p><ul><li>You&#x27;ll notice something when you go to set <strong>SElinux</strong> to <strong>permissive</strong>. The kickstart file already did that for you. It could even have performed the switch from firewalld to iptables for you (but it didn&#x27;t).</li></ul></li><li><p>Issue the following command to obtain and record your centos2 IPADDR in your lab2 logbook: </p></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> address</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="14"><li>Remember that centos3 is text-based interface only (no graphics). To recover from a blank screen, press a key (like the SPACE key) to return to the screen display.</li><li>Record the time taken to install, and compare this to the time taken by the previous installations in your lab2 logbook.</li></ol><p><strong>Answer the INVESTIGATION 2 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-3-managing-virtual-machines-kvm">Investigation 3: Managing Virtual Machines (KVM)<a class="hash-link" href="#investigation-3-managing-virtual-machines-kvm" title="Direct link to heading">​</a></h2><p><strong>Root Privileges</strong></p><p>As part of this investigation you will learn how to switch over to the root account in order to run several privileged commands in sequence. It can be tempting to just use this technique all the time, and never have to worrry about sudo, but do <strong>not</strong> do so. It undermines the security of your system. Use it only when you need it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-backing-up-virtual-machines">Part 1: Backing Up Virtual Machines<a class="hash-link" href="#part-1-backing-up-virtual-machines" title="Direct link to heading">​</a></h3><p>There are two general processes in order to back up your images:</p><ol><li><strong>Compressing your images</strong> (also recommended to backup up to external storage USB Key) using the <strong>gzip</strong> command.</li><li><strong>Backup the VM xml configuration file</strong> (preferably to USB key) using <strong>virsh</strong> shell command to add VM to virtual machine manager list (in the event that the HOST machine is &quot;wiped&quot; and re-installed, but VM images and xml configuration files have been backed up external storage).</li></ol><p>Taking the time to backup the image of the Operating System&#x27;s file system allows the user to return to a &quot;<strong>restoration point</strong>&quot; using the <strong>gunzip</strong> command in case something bad occurs to the OS during a lab.</p><p>Failure to take the time to make and confirm backups can result in loss of lab work for the student!</p><p><strong>Perform the following steps:</strong></p><ol><li><p>Shut down your <strong>centos1</strong>, <strong>centos2</strong>, and <strong>centos3</strong> VMs. For <em>centos2</em> and <em>centos3</em>, which are CLI-only, you can issue the following command to shutdown: <code>poweroff</code>. Please be patient, the VMs will shut down!</p></li><li><p>In your <strong>c7host</strong> VM, open a new Terminal window.</p></li><li><p>Use elevated privileges to list the size and names of files in <code>/var/lib/libvirt/images/</code></p><ul><li>What do these files contain?</li></ul></li><li><p>Use the command <code>sudo -i</code> and enter your password if prompted. You are now root until you use the command <code>exit</code> to return to your normal user account.</p></li><li><p>Change to the images directory by issuing the following command: <code>cd /var/lib/libvirt/images/</code>. Note that you did not need to use sudo, as you are already using elevated permissions.</p></li><li><p>Make a compressed backup of your <strong>centos1.qcow2</strong>, <strong>centos2.qcow2</strong>, and <strong>centos3.qcow2</strong> files to your regular user&#x27;s home directory by issuing each command - one at a time (create <strong>backups</strong> directory <strong>within your regular user&#x27;s home directory</strong> before running these commands):</p></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">gzip</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> centos1.qcow2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ~YourRegularUsername/backups/centos1.qcow2.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">gzip</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> centos2.qcow2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ~YourRegularUsername/backups/centos2.qcow2.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">gzip</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> centos3.qcow2 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ~YourRegularUsername/backups/centos3.qcow2.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>NOTE</strong>: Make certain to use the redirection signs &quot;&lt;&quot; and &quot;<!-- -->&gt;<!-- -->&quot; properly in the command!</li></ul><p><strong>Please be patient</strong></p><p>It may look like the command prompt is stuck but it could take a while for gzip to compress an entire operating system. <strong>NOTE</strong>: Do <strong>NOT</strong> press <code>&lt;ctrl&gt;c</code> to cancel this process. If you do, your archive will become incomplete and your recovery will be corrupt.</p><ol start="7"><li>Compare the size of the compressed and original files (hint: use <strong>ls -lh</strong>). If file is very large (like 15GB), you didn&#x27;t compress it and you need to remove that file and perform the previous step until you get it right!</li><li>Once you are <strong>sure you have all three VMs backed up</strong>, use the <code>exit</code> command to revert back to your normal user.</li><li>Start the <strong><em>centos3</em></strong> VM.</li><li><strong>Make certain that you are in your VM and not in your main system!</strong></li><li>Wreck only your centos3 system! Try this command inside the centos3 virtual machine: <code>sudo rm -rf /*</code> (ignore error messages).</li><li>Shut down and restart the centos3 VM (you may need to use the <strong>Force Reset</strong> option to do so).</li><li>When the machine restarts it will not boot since all system files have been removed!</li><li>Use the <strong>Force Off</strong> option to turn centos3 back off.</li><li>Restore the original image from the backup from your home directory to your <strong>images</strong> directory by typing <code>sudo -i</code> command first <!-- -->[<!-- -->do not forget to <strong>exit</strong> when you are done<!-- -->]<!-- -->, then this command:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gunzip </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> ~YourRegularUsername/backups/centos3.qcow2.gz </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /var/lib/libvirt/images/centos3.qcow2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="16"><li>Restart the VM. Is it working normally?</li><li>You should also make a copy of the XML configuration file for each VM in case you &quot;wipe&quot; and re-install the host machine, and want to add a restored VM backups to the virtual machine manager list. We will demonstrate using the centos3 XML configuration file, and prove that a &quot;clone&quot; can be added to your list.Please perform the following step:</li><li>Execute the following command: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> dumpxml centos3 </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> centos3.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="19"><li>Examine the file <code>centos3.xml</code>. What does it contain? What format is it in?</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-restoring-virtual-machines">Part 2: Restoring Virtual Machines<a class="hash-link" href="#part-2-restoring-virtual-machines" title="Direct link to heading">​</a></h3><ol><li>We will now learn how to download a compressed image file and XML configuration file and add it as a VM to the Virtual Machine Manager menu.</li><li>Issue the following commands:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://matrix.senecacollege.ca/~ops245/centos4.qcow2.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://matrix.senecacollege.ca/~ops245/centos4.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Use gunzip with elevated privileges to decompress the qcow2 image file into the <strong>/var/lib/libvirt/images</strong> directory.</li><li>Issue the command: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> define centos4.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>What happened in the virtual manager window? In order to remove a VM entry in the Virtual Manager window, simply issue the command <strong>virsh undefine VM_name</strong> without the <strong>.xml</strong> file extension</li><li>Start up your new centos4 VM.</li><li>Click on the user <em>OPS245</em>, and click the cog icon.</li></ol><p><img loading="lazy" alt="Cinnamon Cog" src="/OSL740/assets/images/Cinnamon-2-245-3409ad34a5c5a81fae82533ff7ea3b81.png" width="1044" height="899" class="img_ev3q"></p><ol start="8"><li>Notice <em>Cinnamon</em> (<em>Software Rendering</em>) is selected. The Cinnamon desktop environment has been installed on this VM. From this menu, you can select other installed desktop environments. This is how you switch between them. Write it down.</li><li>Login with the password <strong>ops245</strong>. Feel free to explore the new environment.</li><li>Prior to your practical test, you will be required to perform a similar operation to download, unzip and run a VM image for your practical test.</li></ol><p><strong>Shutting Down the Host while Virtual Machines are Running</strong></p><p>If you shut down your host system while virtual machines are running, they will be suspended, and will resume the next time you boot your host system. Note that it is better to shut down the VMs prior to shutting down the host</p><ol start="12"><li><p>For the remainder of these labs, it is assumed that you will backup <strong>both</strong> the images and XML configuration files for <strong>all</strong> Virtual machines, when asked to backup your virtual machines. It is also highly recommended to backup these files to an external storage device (eg. USB key) in case the host machine gets &quot;wiped&quot; and you need to rebuild your HOST machine and then restore your Virtual Machines...</p></li><li><p>Answer this question in your log book:</p><ul><li>In order to fully back up a virtual machine, what information should be saved in addition to the virtual machine image?</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-using-the-command-line-for-vm-state-management">Part 3: Using the Command Line for VM State Management<a class="hash-link" href="#part-3-using-the-command-line-for-vm-state-management" title="Direct link to heading">​</a></h3><p>You will continue our use of the Bash Shell by examining commands will allow the Linux sysadmin to gather information about and manage their Virtual Machines.</p><p><strong>Please check out these <a href="/OSL740/C-ExtraResources/bash-shell-tips">Bash Shell Tips</a> first before continuing with the following steps</strong></p><p><strong>Perform the following steps:</strong></p><ol><li>Start the <strong>centos1</strong> virtual machine, and stop the <strong>centos2</strong> and <strong>centos3</strong> virtual machines.</li><li>Switch to the <strong>c7host</strong> machine, and open a shell terminal.</li><li>Enter these admin commands into your <strong>c7host</strong> machine and note the result:</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> list --all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> list --inactive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>Now, shut-down your centos1 VM normally, and close the centos1 VM window.</li><li>Switch to your terminal and issue the command: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">virsh</span><span class="token plain"> start centos1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>Using the appropriate command check to see if your centos1 VM is now running.</li><li>There are other commands that can be used (such as <strong>suspend</strong>, or <strong>shutdown</strong>). The &quot;shutdown&quot; command may not always work since it relies on the guest handling a particular ACPI event. Why do you think it is useful to have commands to manipulate VMs?</li></ol><p><strong>Virtual Machine Does not Shutdown from Command</strong></p><p>If the Virtual machine fails to shutdown from the <code>virsh shutdown</code> command, then you can go to the <strong>Virtual Machine manager</strong> and <strong>halt</strong> or <strong>shutdown</strong> within the VM itself, then you can click the <strong>PowerOff</strong> button in the VM window. You&#x27;ll want to avoid a forced shutdown since those are equivalent to yanking the power cord out of the wall on a physical machine!</p><p><strong>Answer INVESTIGATION 3 observations / questions in your lab log book.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="investigation-4-using-python-to-automate-managing-virtual-machines">Investigation 4: Using Python To Automate Managing Virtual Machines<a class="hash-link" href="#investigation-4-using-python-to-automate-managing-virtual-machines" title="Direct link to heading">​</a></h2><p>This week you have added some significant capabilities to your python scripting. The ability to run loops and make decisions makes your scripts much more powerful. In this investigation you will write a python script that backs up the centos1, centos2, and centos3 VMs, or lets the user specify which VMs they want backed up.</p><p><strong>Please take a look at these <a href="/OSL740/C-ExtraResources/python-scripting-tips">Python Scripting Tips</a> before continuing with the steps below</strong></p><ol><li>In your <strong>bin</strong> directory, create the file <strong>backupVM.py</strong>, and populate with our standard beginning</li></ol><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env python3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># backupVM.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Purpose: Backs up virtual machines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># USAGE: ./backupVM.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Author: *** INSERT YOUR NAME ***</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Date: *** CURRENT DATE ***</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentuser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">popen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;whoami&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> currentuser</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;root&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;You must be root&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Backing up centos1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;gzip &lt; /var/lib/libvirt/images/centos1.qcow2 &gt; ~YourRegularUsername/backups/centos1.qcow2.gz&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Backing up centos2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;gzip &lt; /var/lib/libvirt/images/centos2.qcow2 &gt; ~YourRegularUsername/backups/centos2.qcow2.gz&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Backing up centos3&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;gzip &lt; /var/lib/libvirt/images/centos3.qcow2 &gt; ~YourRegularUsername/backups/centos3.qcow2.gz&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p>Try to run that script. You&#x27;ll notice it does not work. No matter what you do, it always says you are not root.</p></li><li><p>Modify the print statement that tells the user they must be root to also include the current username, then run the program again.</p></li><li><p>It should print out root, but with an extra new-line. You may have noticed this in your other python scripts so far: the data we get from os.popen() has an extra new-line on the end. We will need to modify the string(s) it gives us a bit. See the side-bar for hints on how to do so.</p></li><li><p>Modify the if statement so it is just getting the current username, not the username and a newline. You can do this using several steps and several variables, but it can also be done in a single line.</p></li><li><p>Test your script to make sure it works. If it doesn&#x27;t, go back and fix it. <strong>Do not continue until it successfully makes backups of your VMs</strong>.</p></li><li><p>There is a weakness to this script as written. Every time you run it, it will make a backup of all three VMs. But what if you only made a change to one of them? Do we really need to wait through a full backup cycle for two machines that didn&#x27;t change? As the script is currently written, we do. But we can make it better. We&#x27;ve provided the scripts with some comments below.</p></li><li></li></ol><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#!/usr/bin/env python3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># backupVM.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Purpose: Backs up virtual machines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># USAGE: ./backupVM.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Author: *** INSERT YOUR NAME ***</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Date: *** CURRENT DATE ***</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Make sure script is being run with elevated permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentuser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">popen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;whoami&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> currentuser </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;root&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;You must be root&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#The rest of this script identifies steps with comments &#x27;Step &lt;something&gt;&#x27;.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#This is not a normal standard for commenting, it has been done here to link the script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># to the instructions on the wiki.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Step A: Find out if user wants to back up all VMs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Step B-1:use the existing loop to back up all the VMs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Backing up centos1&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;gzip &lt; /var/lib/libvirt/images/centos1.qcow2 &gt; ~YourRegularUsername/backups/centos1.qcow2.gz&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Backing up centos2&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;gzip &lt; /var/lib/libvirt/images/centos2.qcow2 &gt; ~YourRegularUsername/backups/centos2.qcow2.gz&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Backing up centos3&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;gzip &lt; /var/lib/libvirt/images/centos3.qcow2 &gt; ~YourRegularUsername/backups/centos3.qcow2.gz&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Step B-2: They don&#x27;t want to back up all VMs, prompt them for which VM they want to back up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Step C: Prompt the user for the name of the VM they want to back up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Step C-1: If the user chose Centos1, back up that machine.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Step C-2: If the user chose Centos2, back up that machine.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#Step C-3: If the user chose Centos3, back up that machine.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="9"><li><p>Before the block that backs up each machine add a prompt to ask the user if they want to back up all machines. Use an if statement to check if they said yes (See comment &#x27;Step A&#x27;).</p><ul><li>if they did say yes, back up all the VMs using your existing block (Comment step B-1).</li><li>If they didn&#x27;t say yes, do nothing for now (you could even use python&#x27;s pass statement).</li></ul></li><li><p>Test your script to make sure it works. Check what happens if you say &#x27;yes&#x27; to the prompt, and check what happens if you say things other than &#x27;yes&#x27;.</p></li><li><p>Now we have a script that asks the user if they want to back up all VMS, and if they say they do, it does. But if they don&#x27;t want to back up every VM, it currently does nothing.</p></li><li><p>Add an else statement at comment Step B-2 to handle the user not wanting to back up every VM. Inside that else clause (Comment step C) ask the user which VM they would like to back up (you can even give them the names of available VMs (Centos1, Centos2, Centos3).</p></li><li><p>Now nest an if statement inside that else (Comments C-1, C-2, and C-3) so that your script can handle what your user just responded with. If they asked for Centos1, back up Centos1. If they want to back up Centos2, only back up Centos2, etc. Hint: You might want to use elif for this.</p></li><li><p>Test your script again. You should now have a script that:</p><ul><li>Makes sure the user is running the script with elevated permissions.</li><li>Asks the user if they want to back up every VM.</li><li>If they want to back up every VM, it backs up every VM.</li><li>If the user does not want to back up every VM, the script asks them which VM they do want to back up.</li><li>If the user selected a single VM, the script will back up that one VM.</li><li>Now you may notice another issue with the script: The gzip lines are almost identical. The only difference in them is the name of the VM file being backed up. In the portion of code where you back up each machine individually (comment steps C-1, C-2, and C-3) try replacing the machine name in the gzip command with a string variable that holds the machine&#x27;s name instead. Note that you will have to make us of string concatenation for this to work correctly.</li></ul></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-2-sign-off-show-instructor">Lab 2 Sign-Off (Show Instructor)<a class="hash-link" href="#lab-2-sign-off-show-instructor" title="Direct link to heading">​</a></h2><p>Follow the submission instructions for lab 2 on Blackboard.</p><p><strong>Backup ALL of your VMs!</strong></p><p>If you have successfully completed this lab, make a new backup of all of your virtual machines onto your USB Key.</p><p><strong>Perform the Following Steps:</strong></p><ol><li>Use the <strong>virsh start</strong> command to launch all the VMs (<strong>centos1</strong>, <strong>centos2</strong>, and <strong>centos3</strong>).</li><li>Inside each virtual machine, run <code>ip a</code> on the command line. Open a Terminal window in centos1 to do so. You&#x27;ll need the IP address of each machine for the next steps.</li><li>Switch to your <strong>c7host</strong> VM, open a terminal, login as root, and change directory to <strong>/root/bin</strong>.</li><li>Issue the Linux command: </li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://osl740.github.io/labs/lab2-check.bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>Give the <strong>lab2-check.bash</strong> file execute permissions (for the file owner).</li><li>Run the shell script and if any warnings, make fixes and re-run shell script until you receive &quot;congratulations&quot; message.</li><li>Arrange proof of the following on the screen:</li></ol><ul class="contains-task-list containsTaskList_mC6p"><li class="task-list-item"><p><input type="checkbox" checked="" disabled=""> <strong>All VMs</strong>:</p><ul><li>All 4 nested VMs <strong>created</strong> and <strong>running</strong></li><li>Proof of <strong>yum updates</strong> on ALL VMs (i.e. results from <strong>yum update</strong> command)</li></ul></li><li class="task-list-item"><p><input type="checkbox" checked="" disabled=""> <strong>c7host VM:</strong></p><ul><li>Run the <strong>lab2-check.bash</strong> script in front of your instructor (must have all  <code>OK</code>  messages)</li></ul></li><li class="task-list-item"><p><input type="checkbox" checked="" disabled=""> <!-- -->Lab2 logbook notes completed.</p></li></ul><ol start="8"><li>Upload a screenshot of the proof listed above, the output file generated by the lab2-check.bash script, your log book, and your backupVM.py to blackboard.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="practice-for-quizzes-tests-midterm--final-exam">Practice For Quizzes, Tests, Midterm &amp; Final Exam<a class="hash-link" href="#practice-for-quizzes-tests-midterm--final-exam" title="Direct link to heading">​</a></h2><ol><li><p>What is the name of the CentOS installation program?</p></li><li><p>What is the name of the file created by the CentOS installation program?</p></li><li><p>Which type of installation works best for confirming compatibility with hardware before installation? Why?</p></li><li><p>Which type of installation works best for installing large numbers of computers? Why?</p></li><li><p>How can you reduce the number of software updates required immediately after installation?</p></li><li><p>How do you start and stop virtual machines?</p></li><li><p>How do you SSH into your virtual machines?</p></li><li><p>List the steps to install a VM from:</p><ul><li>Downloaded iso file</li><li>Network install (without kickstart file)</li><li>Network install (with kickstart file)</li></ul></li><li><p>What is the purpose of the virsh command?</p></li><li><p>How to start and stop VMs using the virsh command?</p></li><li><p>List the steps to correctly backup your VMs to a USB disk</p></li><li><p>List the steps to correctly restore your VMs from a USB disk to your c7host VM.</p></li><li><p>How can you prompt the user for data and store into a variable?</p></li><li><p>Show a few examples how loops can be used to error-check when prompting the user for data.</p></li><li><p>What does the command <strong>rpm -qi centos-release</strong> do and why is it important?</p></li><li><p>What is the difference between <strong>rpm -q centos-release</strong> and <strong>uname -a</strong>?</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/OSL740/tree/main/docs/A-Labs/lab2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/OSL740/A-Labs/lab1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/OSL740/A-Labs/lab3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 3</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#lab-preparation" class="table-of-contents__link toc-highlight">LAB PREPARATION</a><ul><li><a href="#purpose--objectives-of-lab-2" class="table-of-contents__link toc-highlight">Purpose / Objectives of Lab 2</a></li><li><a href="#minimum-required-materials" class="table-of-contents__link toc-highlight">Minimum Required Materials</a></li><li><a href="#linux-command-reference" class="table-of-contents__link toc-highlight">Linux Command Reference</a></li></ul></li><li><a href="#investigation-1-setup-for-nested-virtual-machines" class="table-of-contents__link toc-highlight">Investigation 1: Setup For Nested Virtual Machines</a><ul><li><a href="#part-1-install-kvm-virtualization-application" class="table-of-contents__link toc-highlight">Part 1: Install KVM Virtualization Application</a></li><li><a href="#part-2-configure-vmware-workstation-for-nested-vms" class="table-of-contents__link toc-highlight">Part 2: Configure VMware Workstation for Nested VMs</a></li></ul></li><li><a href="#investigation-2-install-nested-virtual-machines-kvm" class="table-of-contents__link toc-highlight">Investigation 2: Install Nested Virtual Machines (KVM)</a><ul><li><a href="#part-1-installing-vm-from-a-network-graphical" class="table-of-contents__link toc-highlight">Part 1: Installing VM from a Network (Graphical)</a></li><li><a href="#part-2-installing-from-a-network-minimal-install---cli" class="table-of-contents__link toc-highlight">Part 2: Installing from a Network (Minimal install - CLI)</a></li><li><a href="#part-3-installing-from-a-network-using-a-kickstart-file" class="table-of-contents__link toc-highlight">Part 3: Installing from a Network using a Kickstart File</a></li></ul></li><li><a href="#investigation-3-managing-virtual-machines-kvm" class="table-of-contents__link toc-highlight">Investigation 3: Managing Virtual Machines (KVM)</a><ul><li><a href="#part-1-backing-up-virtual-machines" class="table-of-contents__link toc-highlight">Part 1: Backing Up Virtual Machines</a></li><li><a href="#part-2-restoring-virtual-machines" class="table-of-contents__link toc-highlight">Part 2: Restoring Virtual Machines</a></li><li><a href="#part-3-using-the-command-line-for-vm-state-management" class="table-of-contents__link toc-highlight">Part 3: Using the Command Line for VM State Management</a></li></ul></li><li><a href="#investigation-4-using-python-to-automate-managing-virtual-machines" class="table-of-contents__link toc-highlight">Investigation 4: Using Python To Automate Managing Virtual Machines</a></li><li><a href="#lab-2-sign-off-show-instructor" class="table-of-contents__link toc-highlight">Lab 2 Sign-Off (Show Instructor)</a></li><li><a href="#practice-for-quizzes-tests-midterm--final-exam" class="table-of-contents__link toc-highlight">Practice For Quizzes, Tests, Midterm &amp; Final Exam</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">OSL740 - Administration of Open Source Systems</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/OSL740/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seneca College.</div></div></div></footer></div>
<script src="/OSL740/assets/js/runtime~main.37dfe5e2.js"></script>
<script src="/OSL740/assets/js/main.90f2afc0.js"></script>
</body>
</html>